---
title: "Import Link2Care Survey Data - QDS - Visit 1"
author: "Brad Cannell"
date: "2020-12-23 <br> Updated: `r Sys.Date()`"
format: pdf
editor: 
  markdown: 
    wrap: sentence
---

# ‚≠êÔ∏èOverview

This file is used to import the Link2Care follow-up visit survey data and do some initial data cleaning.

[Notes on cleaning individual L2C data sets for merging](https://github.com/brad-cannell/link2care_public/wiki/Notes-on-cleaning-individual-L2C-data-sets-for-merging)

# üì¶Load packages

```{r message=FALSE}
library(dplyr, warn.conflicts = FALSE)
library(purrr, warn.conflicts = FALSE)
library(haven, warn.conflicts = FALSE)
library(here, warn.conflicts = FALSE)
```

```{r}
source("R/standardize_col_names.R")
```

# üì• Import data

-   Import all 5 QDS data frames.
-   These datasets were exported directly from QDS as SPSS files (.SAV), and they have already been run through an SPSS syntax file (`spss_syntax/Visit 1.sps`, `spss_syntax/Visit 2.sps`, etc.).
-   The data was exported from QDS by someone other than MBC.
-   The SPSS syntax files were created by someone other than MBC.

```{r}
qds_spss_path <- "data/qds/"
qds_spss_paths <- paste0(qds_spss_path, "Visit_", 1:5, "_Data.SAV")
```

Check the most recent file modification dates and print for user when this file is being sourced.

```{r}
walk(
  .x = c(1:5),
  .f = function(x) {
    sav_nm <- paste0("Visit_", x, "_Data.SAV")
    path <- paste0(qds_spss_path, sav_nm)
    cat(
      sav_nm, "last modified on OneDrive", as.character(file.info(path)$mtime), "\n"
    )
  }
)
```

Import the data

```{r}
walk(
  .x = c(1:5),
  .f = function(x) {
    new_nm <- paste0("v", x)
    sav_nm <- paste0("Visit_", x, "_Data.SAV")
    path <- paste0(qds_spss_path, sav_nm)
    assign(new_nm, read_sav(path), envir = .GlobalEnv)
  }
)

rm(qds_spss_path)
```

Print a message for when this file is being sourced

```{r}
walk(
  .x = c(1:5),
  .f = function(x) {
    df_nm <- paste0("v", x)
    df <- get(df_nm, envir = .GlobalEnv)
    # Print a message for when this file is being sourced
    cat(
      paste0(Sys.Date(), ":"),
      df_nm, "imported with", nrow(df), "rows and", ncol(df), "columns.\n"
    )
  }
)

# Data check:
# 2023-08-30: v1 imported with 442 rows and 810 columns.
# 2023-08-30: v2 imported with 406 rows and 213 columns.
# 2023-08-30: v3 imported with 273 rows and 542 columns.
# 2023-08-30: v4 imported with 207 rows and 598 columns.
# 2023-08-30: v5 imported with 178 rows and 649 columns.
```

# Clean column names

We have to make the column names match across visits so that we can merge all of the individual QDS data frames into one.

## Reorder column names and manual changes

1.  The columns in the data are not arranged in the order that they exist in the actual QDS survey for some reason. This makes the data harder to work with, and it will make the codebook we eventually create difficult to use. So, we are going to reorder them in the order that they appear in the Link2Care appendix (`codebooks/from_qds/Link2Care_Appendix.pdf`).

-   Note that there are some variables in the data that do not exist in the Link2Care appendix.
    For example, the questions about COVID vaccines.
    We will order them after the columns that do appear in the Link2Care appendix.

-   To prevent us from typing out 800+ variable names manually, we are going to read-in the variable names from the codebook and then create a blog of text that we copy and paste into a code chunk using `select()` below.
    Prepping the codebook to be able to do this took a long time and isn't very future-proof.
    However, we should only have to do this step once.
    As changes occur to QDS in the future, we can just update the code chunk with the `select()` function.

2.  There are some instances where it makes sense to make manual changes to column names now, before the standardization process below. For example, the MMSE columns. It's better to manually change them now because after standardize_col_names you can no longer cut and paste from the Word QDS codebooks. Also, it becomes difficult to be sure which variables in the data correspond to which variables in the codebook (e.g., "mms_4" and "mms_4v").There will also be additional manual changes made after the standardization process.

# üî¥ 2023-08-30: Left off

I want to try a couple of different things here than how I was doing them in `data_survey_01_qds_import.Rmd` before moving on.
If they work, great!
We'll use this file instead.
If they don't, then just go back to what you were doing there.

-   Aside from where they need to be renumbered, keep the columns names true to the QDS codebook.

    -   Actually, don't mess with this right now. I'm not sure what it will mess up down the line.

-   Break up the code into survey sections instead of one big code chunk.

    -   Actually, I don't think this is worth the time it will take.
    -   Part of the reason for wanting to do this was to add an attribute the columns that says was survey instrument they came from. Don't worry about the codebook too much for now. We will worry about it more later. In fact, we may end up using a Quarto book instead of a codebook anyway.

-   Create calculated columns right here in this file instead of relying on the SPSS code.
    This makes it easier to update later.

-   It does.
    Let's try doing the calculations below after merging all of the individual data frames, though.

-   Order the columns in a natural ordering now.

-   This is important.
    However, if we care going to create calculated variables on the merged data frame below, then it seems like a waste of time to reorder the columns now.

-   At some point, I want to make sure that every column name is prefixed to identify the questionnaire it came from.

### Visit 1 reorder

```{r}
v1_reorder <- v1 |> 
  select(
    
    # QDS administrative columns ==============================================
    SUBJECT, TODAY_V1, II_V1, VISIT_V1, TEST_V1, VISIT_TYPE, end_time = ENDTIME1, 
    elapsed_time = ETIME_V1, start_time = CTIME_V1, 
    
    # Screening ===============================================================
    
    ## Screening Questionnaire
    SQ_01 = GENDER, SQ_02 = SQ_2, SQ_03 = SQ_3, SQ_04 = SQ_4,  SQ_05 = SQ_5, 
    SQ_06 = SQ_6, SQ_07 = SQ_7, SQ_07_A = SQ_7A, SQ_07_B = SQ_7B, 
    SQ_07_C = SQ_7C, SQ_07_D = SQ_7D, SQ_08 = SQ_8, SQ_09 = SQ_9, 
    SQ_09_O = SQ_9L, SQ_10, SQ_11, SQ_12, SQ_13, SQ_14, SQ_15, SQ_16, SQ_17, 
    SQ_18, SQ_18_A = SQ_18A, SQ_18_B = SQ_18B, SQ_18_C = SQ_18C, 
    SQ_18_D = SQ_18D, SQ_18_E = SQ_18E, SQ_18_F = SQ_18F, SQ_18_G = SQ_18G, 
    SQ_18_H = SQ_18H, SQ_18_I = SQ_18I, SQ_19, SQ_20, SQ_21, SQ_22, 
    SQ_22_A = SQ_22A, SQ_22_B = SQ_22B, SQ_22_C = SQ_22C, SQ_22_D = SQ_22D, 
    SQ_22_E = SQ_22E, SQ_22_F = SQ_22F, SQ_22_G = SQ_22G, SQ_22_H = SQ_22H, 
    SQ_25 = SQ_23,
    
    ## Mini Mental State Exam
    ### Changes to MMSE column names
    ### In visit 1, the MMSE questions go MMS_4, MMS_4A-MMS_4F, COUNT, MMS4V, 
    ### MMS4VA-MMS4VF, NUM, MMS_5. However, MMS4V should have been MMS4B.

    ### Better to do fix this now because after standardize_col_names you can no 
    ### longer cut and paste from the Word codebooks. Also, it becomes difficult 
    ### to be sure which variables in the data correspond to which variables in 
    ### the codebook (e.g., "mms_4" and "mms_4v").
    
    MMS_01_A = MMS_1A, MMS_01_B = MMS_1B, MMS_01_C = MMS_1C, MMS_01_D = MMS_1D, 
    MMS_01_E = MMS_1E, MMS_01 = MMS_1, 
    MMS_02_A = MMS_2A, MMS_02_B = MMS_2B, MMS_02_C = MMS_2C, MMS_02_D = MMS_2D, 
    MMS_02_E = MMS_2E, MMS_02 = MMS_2, 
    MMS_03 = MMS_3, MMS_03_G = MMS_3G, MMS_03_H = MMS_3H, MMS_03_I = MMS_3I, 
    MMS_03_J = MMS_3J, MMS_03_RECALL = RECAL1,
    MMS_04A = MMS_4, MMS_04A_A = MMS_4A, MMS_04A_B = MMS_4B, MMS_04A_C = MMS_4C, 
    MMS_04A_D = MMS_4D, MMS_04A_E = MMS_4E, MMS_04A_F = MMS_4F, 
    MMS_04A_COUNT = COUNT,
    mms_04B = MMS4V, mms_04b_a = MMS4VA, mms_04b_b = MMS4VB, mms_04b_c = MMS4VC, 
    mms_04b_d = MMS4VD, mms_04b_e = MMS4VE, mms_04b_f = MMS4VF, mms_04b_num = NUM, 
    mms_05 = MMS_5, mms_05_a = MMS_5A, mms_05_b = MMS_5B, mms_05_c = MMS_5C, 
    mms_05_d = MMS_5D, mms_05_recall = RECAL2, 
    mms_06 = MMS_6, mms_06_a = MMS_6A, mms_06_b = MMS_6B, mms_06_c = MMS_6C, 
    mms_06_object = OBJECT, 
    mms_07 = MMS_7, 
    mms_08 = MMS_8, 
    mms_08_a = MMS_8A, mms_08_b = MMS_8B, mms_08_c = MMS_8C, mms_08_d = MMS_8D, 
    mms_08_paper = PAPER, 
    mms_09 = MMS_9, 
    mms_10 = MMS_10, 
    mms_11 = MMS_11, 
    mms_s = MMS_S,
    
    ## Rapid Estimate of Adult Literacy in Medicine (REALM)
    realm_0 = REALM, 
    realm_a = REALMA, 
    realm_b = REALMB, 
    realm_c = REALMC, 
    realm_d = REALMD, 
    realm_e = REALME, 
    realm_f = REALMF, 
    realm_g = REALMG, 
    realm_h = REALMH, 
    realm_i = REALMI, 
    realm_total = REALM_S,
    
    ## Biological/Anthropometric Measures
    anthr_01_weight = WEIGHT, anthr_02_height = HEIGHT, 
    anthr_03_waistc = WAIST_C, anthr_04_co = CO_V1, anthr_05_read_01 = READ1_V1, 
    anthr_05_read_02 = READ2_V1, anthr_05_read_03 = READ3_V5,
    
    
    ## Locator Form
    ### NOT USED V1
    
    # SOCIOECONOMIC STATUS/DEMOGRAPHICS/HOMELESSNESS/CRIMINAL HISTORY INFORMATION
    
    ## Demographic/Background Information Questionnaire
    ### Also, demo_16g was incorrectly numbered when the data was created.
    dem_01_marital = DEM1V1, 
    dem_02_children = DEM2V1, 
    dem_03_race_cat = DEM3V1, 
    dem_04_race_mult = DEM4V1, 
    dem_04_a_white = DEM4V1A, 
    dem_04_b_black = DEM4V1B, 
    dem_04_c_asian = DEM4V1C, 
    dem_04_d_pacific = DEM4V1D, 
    dem_04_e_native = DEM4V1E, 
    dem_04_f_other = DEM4V1F, 
    dem_05_edu_cat = DEM5V1, 
    dem_05_a_ged = DEM5AV1, 
    dem_06_employ_status = DEM6V1, 
    dem_06_a_employ_hpw = DEM6AV1, 
    dem_06_b_employ_7days = DME6BV1, 
    dem_07_ins = DEM7V1, 
    dem_07_a_medicare = DEM7V1A, 
    dem_07_b_medicaid = DEM7V1B, 
    dem_07_c_military = DEM7V1C, 
    dem_07_d_private = DEM7V1D, 
    dem_07_e_none = DEM7V1E, 
    dem_07_f_ins_any = Any_health_insurance, # Calculated in SPSS
    dem_08_ss = DEM8V1, 
    dem_09_ss_amount = DEM9V1, 
    dem_10_snap = DEM10V1, 
    dem_11_snap_amount = DEM11V1,
    dem_12_income_source = DEM12V1, 
    dem_12_a_work = DEM12V1A, 
    dem_12_b_criminalized = DEM12V1B, 
    dem_12_c_disability = DEM12V1C, 
    dem_12_d_emp_benefits = DEM12V1D, 
    dem_12_e_self_emp = DEM12V1E, 
    dem_12_f_sex = DEM12V1F, 
    dem_12_g_drugs = DEM12V1G, 
    dem_12_h_social_assistance = DEM12V1H, 
    dem_12_i_student_loans = DEM12V1I, 
    dem_12_j_friends_relatives = DEM12V1J, 
    dem_12_k_source_other = DEM12V1K, 
    dem_12_l_source_none = DEM12V1L, 
    dem_13_income_12month = DEM13V1,
    dem_13_a_income_cat0 = DEM13AV1, dem_13b_income_cat1 = DEM13BV1,
    dem_13_c_income_cat2 = DEM13CV1, dem_13d_income_cat3 = DEM13DV1,
    dem_13_e_income_cat4 = DEM13EV1, dem_13f_income_cat5 = DEM13FV1,
    dem_13_g_income_cat6 = DEM13GV1, dem_13h_income_cat7 = DEM13HV1, 
    dem_14_income_1month = DEM14V1, 
    dem_14_a_income_cat0 = DEM14AV1, dem_14b_income_cat1 = DEM14BV1, 
    dem_14_c_income_cat2 = DEM14CV1, dem_14d_income_cat3 = DEM14DV1, 
    dem_14_e_income_cat4 = DEM14EV1, dem_14f_income_cat5 = DEM14FV1, 
    dem_14_g_income_cat6 = DEMO16G, 
    dem_15_veteran = DEM15V1, 
    dem_16_minority = DEM16V1, 
    dem_17_sexual_orientation = DEM17V1, 
    dem_18_transgender = DEM18V1,
    
    ## The Brief Homelessness Questionnaire 
    ### Remove the extra "A" from several names (e.g., BH12AV1)

    bh_01 = BH1V1, bh_01_a_years = BH1V1Y, bh_01_b_months = BH1V1M, 
    bh_01_c_days = BH1V1D, 
    bh_02 = BH2V1, bh_03 = BH3V1, 
    bh_04 = BH4V1, bh_04_a_years = BH4V1Y, bh_04_b_months = BH4V1M, 
    bh_04_c_days = BH4V1D, 
    bh_05 = BH5V1, bh_06 = BH6V1, 
    bh_07 = BH7V1, bh_07_a_years = BH7V1Y, bh_07_b_months = BH7V1M, 
    bh_07_c_days = BH7V1W, 
    bh_08 = BH8V1, bh_09 = BH9V1, bh_10 = BH10V1, 
    bh_11 = BH11AV1, 
    bh_12 = BH12AV1, bh_12_a = BH12AV1A, bh_12_b = BH12AV1B, bh_12_c = BH12AV1C, 
    bh_12_d = BH12AV1D, bh_12_e = BH12AV1E, bh_12_f = BH12AV1F, 
    bh_12_g = BH12AV1G, bh_12h = BH12AV1H, bh_12i = BH12AV1I, bh_12_j = BH12AV1J,
    bh_12_k = BH12AV1K, bh_12_l = BH12AV1L, 
    bh_13a = BH13AV1, bh_13a_a = BH13AV1A, bh_13a_b = BH13AV1B, 
    bh_13a_c = BH13AV1C, bh_13a_d = BH13AV1D, bh_13a_e = BH13AV1E, 
    bh_13a_f = BH13AV1F, bh_13b = BH13BV1, 
    bh_13b_a = BH13BV1A, bh_13b_b = BH13BV1B, bh_13b_c = BH13BV1C, 
    bh_13b_d = BH13BV1D, bh_13b_e = BH13BV1E, bh_13b_f = BH13BV1F, 
    bh_13b_g = BH13BV1G, bh_13b_h = BH13BV1H, 
    bh_13c = BH13CV1, bh_13c_a = BH13CV1A, bh_13c_b = BH13CV1B, 
    bh_13c_c = BH13CV1C, bh_13c_d = BH13CV1D, bh_13c_e = BH13CV1E, 
    bh_13c_f = BH13CV1F, bh_13c_g = BH13CV1G, bh_13c_h = BH13CV1H, 
    bh_14 = BH14V1,
    bh_14b = BH14BV1, bh_14b_a_years = BH14BV1Y, bh_14b_b_months = BH14BV1M, 
    bh_14b_c_weeks = BH14BV1W,
    bh_15 = BH15V1, 
    bh_15a = BH15AV1, 
    bh_16 = BH16V1, 
    bh_17 = BH17V1, bh_17_a_years = BH17V1Y, bh_17_b_months = BH17V1M, 
    bh_17_c_weeks = BH17V1W, 
    bh_18 = BH18V1, 
    bh_18b = BH18BV1, 
    bh_18b_a = BH18BV1A, 
    bh_18b_b = BH18BV1B, 
    bh_18b_c = BH18BV1C, 
    bh_18b_d = BH18BV1D, 
    bh_18b_e = BH18BV1E, 
    bh_18b_f = BH18BV1F, 
    bh_18b_g = BH18BV1G, 
    bh_18b_h = BH18BV1H, 
    bh_18b_h_text = BH18B1V1, 
    bh_19 = BH19V1, 
    bh_20 = BH20V1, 
    
    ## MacArthur Scale of Subjective Social Status
    sss_01 = SSS1_V1, sss_02 = SSS2_V1,
    
    # HEALTH, MENTAL HEALTH, & HEALTH BEHAVIOR ================================
    
    ## Patient Health Questionnaire
    phq_01 = PHQ1_V1, phq_02 = PHQ2_V1, phq_03 = PHQ3_V1, phq_04 = PHQ4_V1,
    phq_05 = PHQ5_V1, phq_06 = PHQ6_V1, phq_07 = PHQ7_V1, phq_08 = PHQ8_V1, 
    phq_09 = PHQ9_V1, phq_10 = PHQ10_V1, phq_11 = PHQ11_V1, phq_12 = PHQ12_V1, 
    phq_13 = PHQ13_V1, phq_14 = PHQ14_V1, phq_15 = PHQ15_V1,
    
    ## SF 12 Health Survey
    sfhs_01 = HS1_V1, sfhs_02 = HS2_V1, sfhs_03 = HS3_V1, sfhs_04 = HS4_V1,
    sfhs_05 = HS5_V1, sfhs_06 = HS6_V1, sfhs_07 = HS7_V1, sfhs_08 = HS8_V1,
    sfhs_09 = HS9_V1, sfhs_10 = HS10_V1, sfhs_11 = HS11_V1, sfhs_12 = HS12_V1,
    
    ## Health Related Quality of Life
    hrql_01 = HRQ1_V1, hrql_02 = HRQ2_V1, hrql_03 = HRQ3_V1,
    
    ## Self-Rated Health
    ### The numbering and naming convention in this section gets pretty messed up 
    ### below. Since I already have to retype the name of some many of these, I‚Äôm 
    ### going to go ahead and give these a better name from the beginning. This 
    ### questionnaire is also used in v3, v4, v5
    srh_01 = S2_V1, 
    srh_01_a = S2_V1A, 
    srh_01_b = S2_V1B, 
    srh_01_c = S2_V1C, 
    srh_01_d = S2_V1D, 
    srh_01_e = S2_V1E, 
    srh_01_f = S2_V1F, 
    srh_01_g = S2_V1G, 
    srh_01_h = S2_V1H, 
    srh_02_a = SR3A_V1, 
    srh_02_b = SR3B_V1, 
    srh_02_c = SR3C_V1, 
    srh_02_d = SR3D_V1,
    srh_02_e = SR3E_V1,
    srh_02_f = SR3F_V1,
    srh_03 = S3_V1,
    srh_04 = S4_V1,
    srh_04_a = S4_V1A,
    srh_04_b = S4_V1B,
    srh_04_c = S4_V1C,
    srh_04_d = S4_V1D,
    srh_04_e = S4_V1E,
    srh_04_f = S4_V1F,
    srh_04_g = S4_V1G,
    srh_04_h = S4_V1H,
    srh_05 = S5_V1,
    srh_06 = S6_V1,
    srh_07 = S7_V1,
    srh_07_a = S7_V1A,
    srh_07_b = S7_V1B,
    srh_07_c = S7_V1C,
    srh_07_d = S7_V1D,
    srh_07_e = S7_V1E,
    srh_07_f = S7_V1F,
    srh_07_g = S7_V1G,
    srh_08 = S8_V1,
    srh_08_a = S8_V1A,
    srh_08_b = S8_V1B,
    srh_08_c = S8_V1C,
    srh_08_d = S8_V1D,
    srh_08_e = S8_V1E,
    srh_08_f = S8_V1F,
    srh_08_g = S8_V1G,
    srh_09 = S9_V1,
    srh_09_a = S9_V1A,
    srh_09_b = S9_V1B,
    srh_09_c = S9_V1C,
    srh_09_d = S9_V1D,
    srh_09_e = S9_V1E,
    srh_09_f = S9_V1F,
    srh_09_g = S9_V1G,
    srh_09_h = S9_V1H,
    srh_09_i = S9_V1I,
    srh_09_j = S9_V1J,
    srh_09_k = S9_V1K,
    srh_09_l = S9_V1L,
    srh_09_m = S9_V1M,
    srh_09_n = S9_V1N,
    srh_09_o = S9_V1O,
    srh_09_p = S9_V1P,
    srh_09_q = S9_V1Q,
    srh_09_r = S9_V1R,
    srh_10 = S10_V1,
    srh_11 = S11_V1,
    srh_12 = S12_V1,
    srh_13 = S13_V1,
    srh_14 = S14_V1,
    srh_14_a = S14_V1A,
    srh_14_b = S14_V1B,
    srh_14_c = S14_V1C,
    srh_14_d = S14_V1D,
    srh_15 = S15_V1,
    srh_16 = S16_V1,
    srh_17 = S17_V1,
    srh_18 = S18_V1,
    srh_18_a = S18_V1A,
    srh_18_b = S18_V1B,
    srh_18_c = S18_V1C,
    srh_18_d = S18_V1D,
    srh_18_e = S18_V1E,
    srh_18_f = S18_V1F,
    srh_18_g = S18_V1G,
    srh_18_h = S18_V1H,
    srh_18_i = S18_V1I,
    srh_18_j = S18_V1J,
    srh_18_k = S18_V1K,
    srh_18_l = S18_V1L,
    srh_19 = S19_V1,
    srh_20 = S20_V1,
    srh_21 = S21_V1,
    srh_22 = S22_V1,
    srh_23 = S23_V1,
    srh_24 = S24_V1,
    srh_24_a = S24_V1A,
    srh_24_b = S24_V1B,
    srh_24_c = S24_V1C,
    srh_24_d = S24_V1D,
    srh_24_e = S24_V1E,
    srh_24_f = S24_V1F,
    srh_25a = S25A_V1,
    srh_25a_26 = S26A_V1,
    srh_25a_26_a = S26A_V1A,
    srh_25a_26_b = S26A_V1B,
    srh_25a_26_c = S26A_V1C,
    srh_25a_26_d = S26A_V1D,
    srh_25a_26_e = S26A_V1E,
    srh_25a_26_f = S26A_V1F,
    srh_25a_26_g = S26A_V1G,
    srh_25b = S25B_V1,
    srh_25b_26 = S26B_V1,
    srh_25b_26_a = S26B_V1A,
    srh_25b_26_b = S26B_V1B,
    srh_25b_26_c = S26B_V1C,
    srh_25b_26_d = S26B_V1D,
    srh_25b_26_e = S26B_V1E,
    srh_25b_26_f = S26B_V1F,
    srh_25b_26_g = S26B_V1G,
    srh_25c = S25C_V1,
    srh_25c_26 = S26C_V1,
    srh_25c_26_a = S26C_V1A,
    srh_25c_26_b = S26C_V1B,
    srh_25c_26_c = S26C_V1C,
    srh_25c_26_d = S26C_V1D,
    srh_25c_26_e = S26C_V1E,
    srh_25c_26_f = S26C_V1F,
    srh_25c_26_g = S26C_V1G,
    srh_25d = S25D_V1,
    srh_25d_26 = S26D_V1,
    srh_25d_26_a = S26D_V1A,
    srh_25d_26_b = S26D_V1B,
    srh_25d_26_c = S26D_V1C,
    srh_25d_26_d = S26D_V1D,
    srh_25d_26_e = S26D_V1E,
    srh_25d_26_f = S26D_V1F,
    srh_25d_26_g = S26D_V1G,
    srh_25e = S25E_V1,
    srh_25e_26 = S26E_V1,
    srh_25e_26_a = S26E_V1A,
    srh_25e_26_34b = S26E_V1B,
    srh_25e_26_34c = S26E_V1C,
    srh_25e_26_34d = S26E_V1D,
    srh_25e_26_34e = S26E_V1E,
    srh_25e_26_34f = S26E_V1F,
    srh_25e_26_34g = S26E_V1G,
    srh_27 = S27_V1,
    srh_28 = S28_V1,
    srh_29 = S29_V1,
    srh_30 = S30_V1,
    srh_30_a = S30_V1A,
    srh_30_b = S30_V1B,
    srh_30_c = S30_V1C,
    srh_30_d = S30_V1D,
    srh_30_e = S30_V1E,
    srh_30_f = S30_V1F,
    srh_30_g = S30_V1G,
    srh_31 = S31_V1,
    srh_32 = S32_V1,
    srh_32_a = S32_V1A,
    srh_32_b = S32_V1B,
    srh_32_c = S32_V1C,
    srh_32_d = S32_V1D,
    srh_32_e = S32_V1E,
    srh_32_f = S32_V1F,
    srh_32_g = S32_V1G,
    srh_32_h = S32_V1H,
    srh_32_i = S32_V1I,
    srh_33 = S33_V1,
    srh_34 = S34_V1,
    srh_35 = S35_V1,
    srh_36 = S36_V1,
    srh_37 = S37_V1,
    srh_38 = S38_V1,
    srh_39a = S39A_V1,
    srh_39b = S39B_V1,
    srh_40 = S40_V1,
    srh_41 = S41_V1,
    srh_42 = S42_V1,
    srh_43 = S43_V1,
    srh_43_a = S43_V1A,
    srh_43_b = S43_V1B,
    srh_43_c = S43_V1C,
    srh_43_d = S43_V1D,
    srh_43_e = S43_V1E,
    srh_43_f = S43_V1F,
    srh_43_g = S43_V1G,
    srh_43_h = S43_V1H,
    srh_43_i = S43_V1I,
    
    ## TCU Drug Screen 5
    ### NOT USED V1
    
    ## Primary Care PTSD Screen (PC-PTSD)
    ptsd_01 = PTSD1_V1, ptsd_02 = PTSD2_V1, ptsd_03 = PTSD3_V1, 
    ptsd_04 = PTSD4_V1,
    
    ## BRFSS Adverse Childhood Experience (ACE) Module
    ### NOT USED V1
    
    ## Tobacco History 
    ### On 2021-06-30 the QDS survey was changed to be more like the REDCap survey. 
    ### Explained above
    tob_01 = T1_V1, tob_02 = T2_V1, 
    tob_03a = T3A_V1,
    tob_03a_a_years = T3A_V1Y,
    tob_03a_b_months = T3A_V1M,
    tob_03b = T3B_V1,
    tob_04 = T4_V1,
    tob_05 = T5_V1,
    tob_05_a = T5A1_V1,
    tob_05_b = T5A2_V1,
    tob_05_c = T5A3_V1,
    tob_05_d = T5A4_V1,
    tob_05_e = T5A5_V1,
    tob_05_f = T5A6_V1,
    tob_06 = T6_V1,
    tob_06_a = T6A1_V1,
    tob_06_b = T6A2_V1,
    tob_06_c = T6A3_V1,
    tob_06_d = T6A4_V1,
    tob_06_e = T6A5_V1,
    tob_06_f = T6A6_V1,
    tob_07 = T7_V1,
    tob_08 = T8_V1,
    tob_09 = T9_V1,
    tob_10 = T10_V1,
    tob_11 = T11_V1,
    tob_12 = T12_V1,
    tob_12_a = T12A_V1,
    tob_12_b = T12B_V1,
    tob_13 = T13_V1,
    tob_14 = T14_V1,
    tob_14_a = T14_V1A,
    tob_14_b = T14_V1B,
    tob_14_c = T14_V1C,
    tob_14_d = T14_V1D,
    tob_14_e = T14_V1E,
    tob_14_f = T14_V1F,
    tob_14_g = T14_V1G,
    tob_14_h = T14_V1H,
    tob_14_i = T14_V1I,
    tob_15 = T15_V1,
    tob_16 = T16_V1,
    tob_17 = T17_V1,
    tob_18 = T18_V1,
    tob_19 = T19_V1,
    tob_20 = T20_V1,
    tob_21 = T21_V1,
    tob_22 = T22_V1,
    tob_23 = T23_V1,
    tob_23_a = T23_V1A,
    tob_23_b = T23_V1B,
    tob_23_c = T23_V1C,
    tob_23_d = T23_V1D,
    tob_23_e = T23_V1E,
    tob_23_f = T23_V1F,
    tob_23_g = T23_V1G,
    tob_23_h = T23_V1H,
    tob_24 = T24_V1,
    tob_25 = T25_V1,
    tob_26 = T26A_V1,
    tob_26_a = T26A_V1A,
    tob_26_b = T26A_V1B,
    tob_26_c = T26A_V1C,
    tob_26_d = T26A_V1D,
    tob_26_e = T26A_V1E,
    tob_26_f = T26A_V1F,
    tob_27 = T27_V1,
    tob_28 = T28_V1,
    tob_29 = T29_V1,
    tob_30 = T30_V1,
    tob_31 = T31_V1,
    tob_31_a = T31_V1A,
    tob_31_b = T31_V1B,
    tob_31_c = T31_V1C,
    tob_31_d = T31_V1D,
    tob_31_e = T31_V1E,
    tob_31_f = T31_V1F,
    tob_31_g = T31_V1G,
    tob_31_h = T31_V1H,
    tob_31_i = T31_V1I,
    tob_31_j = T31_V1J,
    tob_31b = T31B_V1,
    tob_31b_a = T31B_V1A,
    tob_31b_b = T31B_V1B,
    tob_31b_c = T31B_V1C,
    tob_32 = T32_V1,
    tob_33 = T33_V1,
    tob_33_a = T33_V1A,
    tob_33_b = T33_V1B,
    tob_33_c = T33_V1C,
    tob_33_d = T33_V1D,
    tob_33_e = T33_V1E,
    tob_33_f = T33_V1F,
    tob_33_g = T33_V1G,
    tob_33_h = T33_V1H,
    tob_33_i = T33_V1I,
    tob_33_j = T33_V1J,
    tob_34 = T34_V1,
    tob_35 = T35_V1,
    tob_36 = T36_V1,
    tob_37 = T37_V1,
    tob_38 = T38_V1,
    tob_39 = T39_V1,
    tob_40 = T40_V1,
    
    ## Heaviness of Smoking Index
    hsi_01 = HSI1_V1, hsi_02 = HSI2_V1, 
    
    ## Behavioral Risk Factor Surveillance System (BRFSS) Inadequate Sleep
    brs_01 = BRS1_V1, brs_02 = BRS2_V1, brs_03 = BRS3_V1, 
    brs_04 = BRS4_V1, brs_05 = BRS5_V1,
    
    ## Alcohol Quantity and Frequency Questionnaire
    aqf_01 = AF1_V1, aqf_02 = AF2M_V1, aqf_03 = AF3TU_V1, aqf_04 = AF4W_V1,
    aqf_05 = AF5TH_V1, aqf_06 = AF6F_V1, aqf_07 = AF6SA_V1, aqf_08 = AF8SU_V1, 
    aqf_09_drinks = DRINKS, aqf_09b = AF9_V1, aqf_09b_a_cat0 = AF9A_V1, 
    aqf_09b_b_cat1 = AF9B_V1, aqf_09_c_cat2 = AF9C_V1,
    
    ## Alcohol and Drug Timeline Follow-Back (TLFB)
    ### NOT USED V1
    
    ## Personality Beliefs Questionnaire
    ### NOT USED V1
    
    ## USDA Food Security Survey
    ### NOT USED V1
    
    ## Meal Survey
    ms_01 = MS1_V1, ms_02 = MS2_V1, ms_03 = MS3_V1, ms_04 = MS8_V1,
    
    ## TCU CJ Client Evaluation of Self and Treatment (CJ CEST)
    ### NOT USED V1
    
    ## Sexual Behaviors
    sb_01 = SB1_V1, sb_02 = SB2_V1, sb_03 = SB3_V1, sb_04 = SB4_V1, 
    sb_05 = SB5_V1, sb_06 = SB6_V1, 
    sb_07 = SB7_V1, sb_07_a = SB7_V1A, sb_07_b = SB7_V1B, 
    sb_07_c = SB7_V1C, sb_07_d = SB7_V1D, sb_07_e = SB7_V1E, sb_07_f = SB7_V1F, 
    sb_07_g = SB7_V1G, 
    sb_08 = SB8_V1, sb_09 = SB9_V1,
    
    # STRESS ==================================================================
    
    ## Detroit Area Study Assessment of Day-to-Day Discrimination
    ddd_01 = DD1_V1, ddd_02 = DD2_V1, ddd_03 = DD3_V1, ddd_04 = DD4_V1, 
    ddd_05 = DD5_V1, ddd_06 = DD6_V1, ddd_07 = DD7_V1, ddd_08 = DD8_V1, 
    ddd_09 = DD9_V1, ddd_10 = DD10_V1,
    
    ## MacArthur Major Discrimination
    ### NOT USED V1
    
    ## Urban Life Stress Scale
    ### NOT USED V1
    
    ## Personal Victimization
    ### NOT USED V1
    
    ## Perceived Stress Scale
    ### NOT USED V1
    
    ## Distress Tolerance Scale (DTS)
    ### NOT USED V1
    
    ## The Pandemic Stress Index (PSI)
    ### NOT USED V1
    
    # NEGATIVE AFFECT
    
    ## Aggression Questionnaire (AQ-12)
    aq_01 = AQ1_V1, aq_02 = AQ2_V1, aq_03 = AQ3_V1, aq_04 = AQ4_V1, 
    aq_05 = AQ5_V1, aq_06 = AQ6_V1, aq_07 = AQ7_V1, aq_08 = AQ8_V1, 
    aq_09 = AQ9_V1, aq_10 = AQ10_V1, aq_11 = AQ11_V1, aq_12 = AQ12_V1,
    
    ## Center for Epidemiological Studies Depression (CES-D)
    ces_01 = CES1_V1, ces_02 = CES2_V1, ces_03 = CES3_V1, ces_04 = CES4_V1, 
    ces_05 = CES5_V1, ces_06 = CES6_V1, ces_07 = CES7_V1, ces_08 = CES8_V1, 
    ces_09 = CES9_V1, ces_10 = CES10_V1,
    
    # INTERPERSONAL/INTRAPERSONAL RESOURCES =================================== 
    
    ## Interpersonal Support Evaluation List
    is_01 = IS1_V1, is_02 = IS2_V1, is_03 = IS3_V1, is_04 = IS4_V1, 
    is_05 = IS5_V1, is_06 = IS6_V1, is_07 = IS7_V1, is_08 = IS8_V1, 
    is_09 = IS9_V1, is_10 = IS10_V1, is_11 = IS11_V1, is_12 = IS12_V1,
    
    ## Religious Participation
    rp_01 = RP1_V1, rp_02 = RP2_V1,
    
    ## Lubben Social Network Scale ‚Äì 6
    lsn_01 = LSN1_V1, lsn_02 = LSN2_V1, lsn_03 = LSN3_V1, lsn_04 = LSN4_V1,
    lsn_05 = LSN5_V1, lsn_06 = LSN6_V1,
    
    ## HOMELESS TIMELINE FOLLOW-BACK (TLFB)
    ### NOT USED V1
    
    ## Resource Utilization Questionnaire
    ruq_01 = R1_V1, ruq_02 = R2_V1, ruq_03 = R3_V1, ruq_04 = R4_V1, 
    ruq_05 = R5_V1, ruq_06 = R6_V1, ruq_07 = R7_V1, ruq_08 = R8_V1, 
    ruq_09 = R9_V1, ruq_10 = R10_V1, ruq_11 = R11_V1, ruq_11a = R11B_V1, 
    ruq_12 = R12_V1, 
    ruq_13 = R13_V1, 
    ruq_14 = R14_V1, 
    ruq_15 = R15_V1, 
    ruq_15_a = R15_V1A, 
    ruq_15_b = R15_V1B, 
    ruq_15_c = R15_V1C, 
    ruq_15_d = R15_V1D, 
    ruq_15_e = R15_V1E, 
    ruq_15_f = R15_V1F, 
    ruq_15_g = R15_V1G, 
    ruq_15_h = R15_V1H, 
    ruq_15_i = R15_V1I, 
    ruq_15_j = R15_V1J, 
    ruq_15_k = R15_V1K, 
    ruq_15_l = R15_V1L, 
    ruq_15_m = R15_V1M, 
    ruq_15_n = R15_V1N, 
    ruq_15_o = R15_V1O,
    
    ## Barriers to Phone Based Case Management
    bpm_01 = BPM1_V1, bpm_02 = BPM2_V1, bpm_03 = BPM3_V1, bpm_04 = BPM4_V1,
    bpm_05 = BPM5_V1, bpm_05_a = BPM5_V1A, bpm_05_b = BPM5_V1B, 
    bpm_05_c = BPM5_V1C, bpm_05_d = BPM5_V1D, bpm_05_e = BPM5_V1E, 
    bpm_05_f = BPM5_V1F, bpm_05_g = BPM5_V1G,
    
    # End of sections from the Link2Care appendix =============================
    
    ## Add everything() to make sure no columns are lost. Many of these will be
    ## calculated variables from the SPSS script. 
    everything()
)
```

**Data check:** Take a look at what comes after `BPM5_V1G`.
Over time, if new variables are added to the QDS data, this could change.
If it does, we may want to rename or rearrange the new columns.
Make sure to use the last column named before `everything()` in the code above as the starting column name in the code below.

```{r}
#| eval: false
v1_reorder |>
  select(bpm_05_g:last_col()) |> 
  names()
```

There are 78 columns after `BPM5_V1G`.
- One of them is `SUBJECT1`, which we drop below.
- The remaining 77 columns are calculated variables created in SPSS.
- Later, we will create calculated columns in this file instead of relying on the SPSS code.
The rationale for doing so is that it will make the calculated columns easier to updated/maintain.
We won't have to switch back and forth between SPSS and R.
- We will create the calculated variables after merging all of the individual data frames instead of creating them in each visit data frame.
Again, this will make the code easier to maintain.
If we need to make a change, we will only need to do so once -- not once for each visit.

#### v1: Drop unneeded columns

-   Drop the `SUBJECT1` column. I'm not sure why it exists, but it has a missing value in every row.
-   Drop the `TEST_V1` column. I'm not sure why it exists, but it has a missing value in every row.
-   Drop the SPSS calculated columns for now. We will recreate them later.

```{r}
# Helpful regex: \[\d*\] 
# Helpful regex: [ ]{2,}
drop_v1 <- c(
  "SUBJECT1", "mms_score", "MMS_total", "MMS_severity", 
  "PHQ1_V1_dichot", "PHQ2_V1_dichot", "PHQ3_V1_dichot", "PHQ4_V1_dichot", 
  "PHQ5_V1_dichot", "PHQ6_V1_dichot", "PHQ7_V1_dichot", "PHQ8_V1_dichot", 
  "PHQ_dep_dichot_total", "PHQ_symp_V1", "PHQ_mdd_V1", "PHQ_gad_V1", "hsi", 
  "HSI_cat", "BRIS2_QD_dichot", "QD_unintent_slp", "PA", "VA", "A", "HA", 
  "AQ", "CES5_V1r", "CES8_V1r", "CES_V1_total", "CES_V1_total_labelled", 
  "CES1_V1_dichot", "CES2_V1_dichot", "CES3_V1_dichot", "CES4_V1_dichot", 
  "CES5_V1r_dichot", "CES6_V1_dichot", "CES7_V1_dichot", "CES8_V1r_dichot", 
  "CES9_V1_dichot", "CES10_V1_dichot", "CES_V1_dichot_total", 
  "CES_V1_dichot_labelled", "IS1_V1r", "IS2_V1r", "IS7_V1r", "IS8_V1r", 
  "IS11_V1r", "IS12_V1r", "ISEapp_V1", "ISEbel_V1", "ISEtan_V1", 
  "LSN_V1_family", "LSN_V1_friends", "LSN_V1_total", "DD_V1_total", 
  "PTSD_V1_total", "PTSD_V1_postive", "HS1_V1_dichotomous", "AlcQF_V1", 
  "binge_drinker_V1", "Heavy_drinker", "weight_kg_V1", "height_meter_V1", 
  "height_meter_sq_V1", "BMI_V1", "weight_status_V1", "obese_V1", 
  "ovrwt_obese_V1", "current_months_homeless", "friends_smoke_V1", 
  "spouse_smoke", "Mental_Health_dx", "pain", "Substance_abuse_hs", 
  "Substance_use_30d", "Time_to_complete_V1", "T5_V1val", "T6_V1val",
  
  # Other columns to drop that weren't at the end of the data frame
  "TEST_V1"
)

v1_reorder <- v1_reorder |>
  select(-all_of(drop_v1))

rm(drop_v1)
```

**Data check:** Data dimensions

```{r}
dim(v1_reorder) # 442 732
```

#### v1: Add source attribute for codebook

```{r}
for (i in seq_along(names(v1_reorder))) {
  attr(v1_reorder[[i]], "source") <- "Visit 1"
}

rm(i)
```

### Visit 2 reorder

```{r}
v2_reorder <- v2 %>% 
  select(
    
    # QDS administrative columns ==============================================
    SUBJECT, TODAY_V2, II_V2, VISIT_V2, TEST_V2, VISIT_TYPE, end_time = ENDTIME2, 
    elapsed_time = ETIME_V2, start_time = CTIME_V2,
    # Screening ===============================================================
    
    ## Screening Questionnaire
    ### NOT USED V2
    
    ## Mini Mental State Exam
    ### NOT USED V2
    
    ## Rapid Estimate of Adult Literacy in Medicine (REALM)
    ### NOT USED V2
    
    ## Biological/Anthropometric Measures
    anthr_05_read_01 = READ1_V2, anthr_05_read_02 = READ2_V2, 
    anthr_05_read_03 = READ3_V2,
    
    ## Locator Form
    ### NOT USED V2
    
    # SOCIOECONOMIC STATUS/DEMOGRAPHICS/HOMELESSNESS/CRIMINAL HISTORY INFORMATION 
    
    ## Demographic/Background Information Questionnaire
    ### NOT USED V2
    
    ## The Brief Homelessness Questionnaire
    ### NOT USED V2
    
    ## MacArthur Scale of Subjective Social Status
    ### Rename these to indicate which questionnaire the came from
    sss_01 = WELL_BEING1, sss_02 = WELL_BEING2, 
    sss_03 = WELL_BEING3,
    
    # HEALTH, MENTAL HEALTH, & HEALTH BEHAVIOR ================================
    
    ## Patient Health Questionnaire
    ### NOT USED V2
    
    ## SF 12 Health Survey
    ### NOT USED V2
    
    ## Health Related Quality of Life
    ### NOT USED V2
    
    ## Self-Rated Health
    ### NOT USED V2
    
    ## TCU Drug Screen 5
    ds_01 = DS1_V2, ds_02 = DS2_V2, ds_03 = DS3_V2, ds_04 = DS4_V2, 
    ds_05 = DS5_V2, ds_06 = DS6_V2, ds_07 = DS7_V2, ds_08 = DS8_V2, 
    ds_09 = DS9_V2, ds_10a = DS10A_V2, ds_10b = DS10B_V2, ds_11a = DS11A_V2, 
    ds_11b = DS11B_V2,
    
    ## Primary Care PTSD Screen (PC-PTSD)
    ### NOT USED V2
    
    ## BRFSS Adverse Childhood Experience (ACE) Module
    brac_01 = BRAC1, brac_02 = BRAC2, brac_03 = BRAC3, brac_04 = BRAC4, 
    brac_05 = BRAC5, brac_06 = BRAC6, brac_07 = BRAC7, brac_08 = BRAC8, 
    brac_09 = BRAC9, brac_10 = BRAC10, brac_11 = BRAC11,
    
    ## Tobacco History 
    ### NOT USED V2
    
    ## Heaviness of Smoking Index
    ### NOT USED V2
    
    ## Behavioral Risk Factor Surveillance System (BRFSS) Inadequate Sleep
    ### NOT USED V2
    
    ## Alcohol Quantity and Frequency Questionnaire
    ### NOT USED V2
    
    ## Alcohol and Drug Timeline Follow-Back (TLFB)
    ### NOT USED V2
    
    ## Personality Beliefs Questionnaire
    pbq_01 = PBQ1, pbq_02 = PBQ2, pbq_03 = PBQ3, pbq_04 = PBQ4, pbq_05 = PBQ5,
    pbq_06 = PBQ6, pbq_07 = PBQ7, 
    
    ## USDA Food Security Survey
    ffs_01 = FSS1_V2, ffs_02 = FSS2_V2, ffs_03a = FSS3_V2, ffs_03b = FSS3A_V2, 
    ffs_04 = FSS4_V2, ffs_05 = FSS5_V2,
    
    ## Meal Survey
    ### NOT USED V2
    
    ## TCU CJ Client Evaluation of Self and Treatment (CJ CEST)
    cj_01 = CJ1_V2, cj_02 = CJ2_V2, cj_03 = CJ3_V2, cj_04 = CJ4_V2,
    cj_05 = CJ5_V2, cj_06 = CJ6_V2, cj_07 = CJ7_V2, cj_08 = CJ8_V2, 
    cj_09 = CJ9_V2, cj_10 = CJ10_V2, cj_11 = CJ11_V2, cj_12 = CJ12_V2, 
    cj_13 = CJ13_V2, cj_14 = CJ14_V2, cj_15 = CJ15_V2, cj_16 = CJ16_V2, 
    cj_17 = CJ17_V2, cj_18 = CJ18_V2, cj_19 = CJ19_V2, cj_20 = CJ20_V2, 
    cj_21 = CJ21_V2, cj_22 = CJ22_V2, cj_23 = CJ23_V2, cj_24 = CJ24_V2, 
    cj_25 = CJ25_V2, cj_26 = CJ26_V2, cj_27 = CJ27_V2, cj_28 = CJ28_V2, 
    cj_29 = CJ29_V2, cj_30 = CJ30_V2, cj_31 = CJ31_V2, cj_32 = CJ32_V2, 
    cj_33 = CJ33_V2, cj_34 = CJ34_V2, cj_35 = CJ35_V2, cj_36 = CJ36_V2, 
    cj_37 = CJ37_V2, cj_38 = CJ38_V2, cj_39 = CJ39_V2, cj_40 = CJ40_V2,
    
    ## Sexual Behaviors
    ### NOT USED V2
    
    # STRESS ==================================================================
    
    ## Detroit Area Study Assessment of Day-to-Day Discrimination
    ### NOT USED V2
    
    ## MacArthur Major Discrimination
    mmd_01_a = MMD1A, mmd_01_b = MMD1B, mmd_01_c = MMD1C, mmd_01_d = MMD1D, 
    mmd_01_e = MMD1E, mmd_01_f = MMD1F, mmd_01_g = MMD1G, mmd_01_h = MMD1H, 
    mmd_01_i = MMD1I, mmd_01_j = MMD1J, mmd_01_k = MMD1K, 
    mmd_02 = MMD2, mmd_03 = MMD3, mmd_04 = MMD4,
    
    ## Urban Life Stress Scale
    uls_01 = ULS1_V2, uls_02 = ULS2_V2, uls_03 = ULS3_V2, uls_04 = ULS4_V2,
    uls_05 = ULS5_V2, uls_06 = ULS6_V2, uls_07 = ULS7_V2, uls_08 = ULS8_V2,
    uls_09 = ULS9_V2, uls_10 = ULS10_V2, uls_11 = ULS11_V2, uls_12 = ULS12_V2,
    uls_13 = ULS13_V2, uls_14 = ULS14_V2, uls_15 = ULS15_V2, uls_16 = ULS16_V2,
    uls_17 = ULS17_V2, uls_18 = ULS18_V2, uls_19 = ULS19_V2, uls_20 = ULS20_V2,
    uls_21 = ULS21_V2,
    
    ## Personal Victimization
    pv_01 = PV1_V2, pv_02 = PV2_V2, pv_03 = PV3_V2,
    
    ## Perceived Stress Scale
    ps_01 = PS1_V2, ps_02 = PS2_V2, ps_03 = PS3_V2, ps_04 = PS4_V2, 
    
    ## Distress Tolerance Scale (DTS)
    dts_01 = DTS1_V2, dts_02 = DTS2_V2, dts_03 = DTS3_V2, dts_04 = DTS4_V2,
    dts_05 = DTS5_V2, dts_06 = DTS6_V2, dts_07 = DTS7_V2, dts_08 = DTS8_V2,
    dts_09 = DTS9_V2, dts_10 = DTS10_V2, dts_11 = DTS11_V2, dts_12 = DTS12_V2,
    dts_13 = DTS13_V2, dts_14 = DTS14_V2, dts_15 = DTS15_V2, dts_16 = DTS16_V2,
    
    ## The Pandemic Stress Index (PSI)
    ### NOT USED V2
    
    # NEGATIVE AFFECT =========================================================
    
    ## Aggression Questionnaire (AQ-12)
    ### NOT USED V2
    
    ## Center for Epidemiological Studies Depression (CES-D)
    ### NOT USED V2
    
    # INTERPERSONAL/INTRAPERSONAL RESOURCES ===================================
    
    ## Interpersonal Support Evaluation List
    ### NOT USED V2
    
    ## Religious Participation
    ### NOT USED V2
    
    ## Lubben Social Network Scale ‚Äì 6
    ### NOT USED V2
    
    ## HOMELESS TIMELINE FOLLOW-BACK (TLFB)
    ### NOT USED V2
    
    ## Resource Utilization Questionnaire
    ### NOT USED V2
    
    ## Barriers to Phone Based Case Management
    ### NOT USED V2
    
    # End of sections from the Link2Care appendix =============================
    
    # COVID-19 Vaccine
    ### These variables don't appear in the the Link2Care appendix or the QDS 
    ### codebooks. They do appear in the REDCap codebook, though.
    vac_01 = VAC1_V2, 
    vac_02 = VAC2_V2, vac_02_a_year = VAC2_V2Y, vac_02_b_month = VAC2_V2M, 
    vac_02_c_day = VAC2_V2D, 
    vac_03 = VAC3_V2, vac_03_a_year = VAC3_V2Y, vac_03_b_month = VAC3_V2M,
    vac_03_c_day = VAC3_V2D,
    
    ## Add everything() to make sure no columns are lost. Many of these will be
    ## calculated variables from the SPSS script. 
    everything()
)
```

Data check: Take a look at what comes after `VAC3_V2D`.
Over time, if new variables are added to the QDS data, this could change.
If it does, we may want to rename or rearrange the new columns.
Make sure to use the last column named before `everything()` in the code above as the starting column name in the code below.

```{r}
#| eval: false
v2_reorder |>
  select(vac_03_c_day:last_col()) |> 
  names()
```

There are 54 columns after `VAC3_V2D`.
- One of them is `II_V1`, which we drop below.
- The remaining 52 columns are calculated variables created in SPSS.
- Below, we will create calculated columns in this file instead of relying on the SPSS code.
The rationale for this is that it will make the columns easier to updated/maintain.
We won't have to switch back and forth between SPSS and R.
- However, we will create the calculated variables after merging all of the individual data frames instead of creating them in each visit data frame.
Again, this will make the code easier to maintain.
If we need to make a change, we will only need to do so once -- not once for each visit.

#### v1: Drop unneeded columns

-   Drop the `II_V1` column. I'm not sure why a "V1" column exists in the visit 2 data. There is also a `II_V2`.
-   Drop the `TEST_V2` column. I'm not sure why it exists, but it has a missing value in every row.
-   Drop the SPSS calculated columns for now. We will recreate them later.

```{r}
# Helpful regex: \[\d*\] 
# Helpful regex: [ ]{2,}
# Helpful regex: \" \"
drop_v2 <- c(
  "DS10_V2", "DS11_V2", "TCU_DS_TOTAL_V2", 
  "TCU_DS_SCORE_V2", "pbq_v2_total", "fss_a_V2", "fss_b_V2", "fss_c_V2", 
  "fss_d_V2", "fss_e_V2", "fss_f_V2", "FSS_V2_total", "FSS_V2_score", 
  "FSS_V2_score_dichotomous", "TCU_desire_v2_total", "TCU_tn_v2_total", 
  "TCU_ts_v2_total", "CJ21r_V2", "CJ22r_V2", "CJ23r_V2", "CJ25r_V2", 
  "TCU_se_v2_total", "TCU_hs_v2_total", "CJ34r_V2", "CJ35r_V2", "CJ36r_V2", 
  "TCU_rt_v2_total", "MMD_total", "uls_V2_total", "PS2r_V2", "PS3r_V2", 
  "PS_V2_total", "DTS1r_V2", "DTS2r_V2", "DTS3r_V2", "DTS4r_V2", "DTS5r_V2", 
  "DTS6r_V2", "DTS8r_V2", "DTS9r_V2", "DTS10r_V2", "DTS11r_V2", "DTS12r_V2", 
  "DTS13r_V2", "DTS14r_V2", "DTS15r_V2", "DTS16r_V2", "DTS_tolerance_V2", 
  "DTS_absorption_V2", "DTS_appraisal_V2", "DTS_regulation_V2", "DTS_total_V2", 
  "Time_to_complete_V2",

  # Other columns to drop that weren't at the end of the data frame
  "II_V1", "TEST_V2"
)

v2_reorder <- v2_reorder |>
  select(-all_of(drop_v2))

rm(drop_v2)
```

Data check: Data dimensions

```{r}
dim(v2_reorder) # 406 158
```

#### v1: Add source attribute for codebook

```{r}
for (i in seq_along(names(v2_reorder))) {
  attr(v2_reorder[[i]], "source") <- "Visit 2"
}

rm(i)
```

# üî¥ 2023-08-30: Left off here...

-   I need to import v3-v5 using the same process as above.
-   But first:
    -   Work out the process of combining the v1 and v2.
    -   Work out the process of creating calculated variables in the joined data frame. Borrow code from `data_survey_01_import.Rmd`.

# Aggregate Set Creation

We created our standardized variable names.
Prior to application, we checked their format and the differences between data sets.

There were a total of 877 variables:

-   720 unique to visit 1

-   146 unique to visit 2

-   11 common to both visit 1 and visit 2

```{r}
v1_names <- standardize_col_names(colnames(v1_reorder))
colnames(v1_reorder) <- v1_names
v2_names <- standardize_col_names(colnames(v2_reorder))
colnames(v2_reorder) <- v2_names

all_vars <- unique(c(v1_names, v2_names))
length(all_vars)

length(setdiff(v1_names, v2_names))
length(setdiff(v2_names, v1_names))

common_vars <- v1_names[v1_names %in% v2_names]
length(common_vars)
```

These common variables appeared to primarily be bookkeeping variables, such as the subject ID, date of visit, visit number, interviewer initials, end time, and so on. They also included three questions regarding the use of reading glasses for completing the QDS survey, and the MacArthur Scale of Subjective Social Status variables.

```{r}
common_vars
```

To create a single stacked data set, we first had to create the skeleton and organization of the combined data set.

## Identification and Ordering of Variables

We isolated variables by section and instrument to facilitate ordering according to the master appendix. To facilitate this processing, a small convenience function was written.

```{r}
var_tibble_instrument <- function(inst_var_list, inst_order, inst_name){
  
  temp_tibble <- tibble::tibble(
    'variable' = inst_var_list,
    'inst_ord' = inst_order,
    'instrument' = inst_name
    ) %>%
    dplyr::mutate('item_ord' = row_number())
  
  temp_tibble

}
```


### Initiating Tibble

We initiated a tibble to facilitate pulling variable names utilizing tidyselect.

```{r}
colname_tibble <- tibble::tibble(!!!all_vars, .rows = 0, 
                                 .name_repair = ~all_vars)
```

We initiated a tibble to collect our variables and desired order, with additional details to facilitate later reorganization.

```{r}
var_ord_cols <- c('variable', 'sec_ord', 'section', 'inst_ord', 'instrument',
                  'item_ord')

variable_order <- tibble::tibble(!!!var_ord_cols, .rows = 0, 
                                 .name_repair = ~var_ord_cols)
```

### Screening Section

```{r}
# SCREENING ===================================================================

    # Screening 

screening_inst_vars <- sort(colname_tibble %>% 
  select(all_of(starts_with("sq_"))
         ) %>%
  names())

sec_tibble <- var_tibble_instrument(screening_inst_vars, 1, 
                                    "Screening Instrument")

    ## Mini Mental State Exam

mms_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("mms_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(mms_vars, 2, 
                                    "Mini Mental State Exam"))
    
    ## Rapid Estimate of Adult Literacy in Medicine (REALM)

realm_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("realm_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(realm_vars, 3,
                        "Rapid Estimate of Adult Literacy in Medicine (REALM)"))

    # Aggregating section

screening_sec_vars <- c(screening_inst_vars, mms_vars, realm_vars, 
                        anthropometric_vars, locator_vars)

sec_tibble <- sec_tibble %>%
  mutate(sec_ord = 2,
         section = "Screening")

variable_order <- rbind(variable_order, sec_tibble)
```

### Socioeconomic Status/Demographics/Homelessness/Criminal History Section

```{r}
# DEMOGRAPHIC =================================================================

    ## Biological/Anthropometric Measures

anthropometric_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("anthr_"))
         ) %>%
  names())

sec_tibble <- var_tibble_instrument(anthropometric_vars, 1, 
                                    "Anthropometric Measures")

    ## Locator Form

locator_vars <- c() #!!! PLACEHOLDER

# sec_tibble <- rbind(sec_tibble, 
#                     var_tibble_instrument(locator_vars, 2, 
#                                     "Locator Form"))

    ## Demographic/Background Information Questionnaire

demo_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("dem_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(demo_vars, 3, 
                                    "Demographic Questionnaire"))

    ## The Brief Homelessness Questionnaire 

briefhomeless_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("bh_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(briefhomeless_vars, 4, 
                                    "Brief Homelessness Questionnaire"))

    ## MacArthur Scale of Subjective Social Status
msss_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("sss_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(msss_vars, 5, 
                                "MacArthur Scale of Subjective Social Status"))
    # Aggregating section

demographic_vars <- c(demo_vars, briefhomeless_vars, msss_vars)

sec_tibble <- sec_tibble %>%
  mutate(sec_ord = 3,
         section = "Demographic")

variable_order <- rbind(variable_order, sec_tibble)


```

### Health, Mental Health, and Health Behavior Section

```{r}

    ## Patient Health Questionnaire

phq_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("phq_"))
         ) %>%
  names())

sec_tibble <- var_tibble_instrument(phq_vars, 1, 
                                    "Patient Health Questionnaire")

    ## SF 12 Health Survey

sfhs_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("sfhs_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(sfhs_vars, 2, 
                                    "SF 12 Health Survey"))

    ## Health Related Quality of Life

hrq_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("hrql_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(hrq_vars, 3, 
                                    "Health Related Quality of Life"))

    ## Self-Rated Health

srh_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("srh_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(srh_vars, 4, 
                                    "Self-Rated Health"))

    ## TCU Drug Screen 5

drug_screen_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("ds_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(drug_screen_vars, 5, 
                                    "TCU Drug Screen 5"))

    ## Primary Care PTSD Screen (PC-PTSD)

ptsd_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("ptsd_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(ptsd_vars, 6, 
                                    "Primary Care PTSD Screen (PC-PTSD)"))

    ## BRFSS Adverse Childhood Experience (ACE) Module

brfss_ace_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("brac_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(brfss_ace_vars, 7, 
                            "BRFSS Adverse Childhood Experience (ACE) Module"))

    ## Tobacco History 

tob_hist_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("tob_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(tob_hist_vars, 8, 
                                    "Tobacco History"))

    ## Heaviness of Smoking Index

tob_hsi_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("hsi_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(tob_hsi_vars, 9, 
                                    "Heaviness of Smoking Index"))

    ## Behavioral Risk Factor Surveillance System (BRFSS) Inadequate Sleep

brfss_sleep_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("brs_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(brfss_sleep_vars, 10, 
        "Behavioral Risk Factor Surveillance System (BRFSS) Inadequate Sleep"))

    ## Alcohol Quantity and Frequency Questionnaire

alc_qf_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("aqf_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(alc_qf_vars, 11, 
                              "Alcohol Quantity and Frequency Questionnaire"))

    ## Alcohol and Drug Timeline Follow-Back (TLFB)

alc_tlfb_vars <- c() #!!! PLACEHOLDER

# sec_tibble <- rbind(sec_tibble, 
#                     var_tibble_instrument(alc_tlfb_vars, 12, 
#                                 "Alcohol and Drug Timeline Follow-Back (TLFB)"))

    ## Personality Beliefs Questionnaire

personal_beliefs_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("pbq_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(personal_beliefs_vars, 13, 
                                    "Personality Beliefs Questionnaire"))

    ## USDA Food Security Survey

food_security_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("ffs_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(food_security_vars, 14, 
                                    "Food Security Vars"))

    ## Meal Survey

meal_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("ms_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(meal_vars, 15, 
                                    "Meal Survey"))

    ## TCU CJ Client Evaluation of Self and Treatment (CJ CEST)

self_treatment_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("cj_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(self_treatment_vars, 16, 
                    "TCU CJ Client Evaluation of Self and Treatment (CJ CEST)"))

    ## Sexual Behaviors

sexual_bh_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("sb_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(sexual_bh_vars, 17, 
                                    "Sexual Behaviors"))

    # Aggregating section

health_vars <- c(phq_vars, sfhs_vars, hrq_vars, srh_vars, drug_screen_vars,
                 ptsd_vars, brfss_ace_vars, tob_hist_vars, tob_hsi_vars, 
                 brfss_sleep_vars, alc_qf_vars, alc_tlfb_vars, 
                 personal_beliefs_vars, food_security_vars, meal_vars, 
                 self_treatment_vars, sexual_bh_vars)

sec_tibble <- sec_tibble %>%
  mutate(sec_ord = 4,
         section = "Health")

variable_order <- rbind(variable_order, sec_tibble)

```


### Stress Section
```{r}
    ## Detroit Area Study Assessment of Day-to-Day Discrimination

discrim_daily_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("ddd_"))
         ) %>%
  names())

sec_tibble <- var_tibble_instrument(discrim_daily_vars, 1, 
                  "Detroit Area Study Assessment of Day-to-Day Discrimination")

    ## MacArthur Major Discrimination

discrim_major_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("mmd_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(discrim_major_vars, 2, 
                                          "MacArthur Major Discrimination"))

    ## Urban Life Stress Scale

urban_stress_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("uls_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(urban_stress_vars, 3, 
                                          "Urban Life Stress Scale"))
    
    ## Personal Victimization

personal_vic_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("pv_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(personal_vic_vars, 4, 
                                          "Personal Victimization"))
    
    ## Perceived Stress Scale

perceived_stress_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("ps_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(perceived_stress_vars, 5, 
                                          "Perceived Stress Scale"))
    
    ## Distress Tolerance Scale (DTS)

distress_tol_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("dts_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(distress_tol_vars, 6, 
                                          "Distress Tolerance Scale (DTS)"))

    ## The Pandemic Stress Index (PSI)

pandemic_stress_vars <- c() #!!! PLACEHOLDER

# sec_tibble <- rbind(sec_tibble, 
#                     var_tibble_instrument(pandemic_stress_vars, 7, 
#                                           "Pandemic Stress Index (PSI)"))

    # Aggregating section

stress_vars <- c(discrim_daily_vars, discrim_major_vars, urban_stress_vars, 
                 personal_vic_vars, perceived_stress_vars, distress_tol_vars, 
                 pandemic_stress_vars)

sec_tibble <- sec_tibble %>%
  mutate(sec_ord = 5,
         section = "Stress")

variable_order <- rbind(variable_order, sec_tibble)
```


### Negative Affect Section
```{r}
    ## Aggression Questionnaire (AQ-12)

aggression_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("aq_"))
         ) %>%
  names())

sec_tibble <- var_tibble_instrument(aggression_vars, 1, 
                                    "Aggression Questionnaire (AQ-12)")

    ## Center for Epidemiological Studies Depression (CES-D)

cesd_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("ces_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(cesd_vars, 2, 
                      "Center for Epidemiological Studies Depression (CES-D)"))

    # Aggregating section

negative_affect_vars <- c(aggression_vars, cesd_vars)

sec_tibble <- sec_tibble %>%
  mutate(sec_ord = 6,
         section = "Negative Affect")

variable_order <- rbind(variable_order, sec_tibble)
```


### Interpersonal Section

```{r}
    ## Interpersonal Support Evaluation List

interper_support_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("is_"))
         ) %>%
  names())

sec_tibble <- var_tibble_instrument(interper_support_vars, 1, 
                                    "Interpersonal Support Evaluation List")

    ## Religious Participation

religious_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("rp_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(religious_vars, 2, 
                                          "Religious Participation"))

    ## Lubben Social Network Scale ‚Äì 6

lubben_social_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("lsn_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(lubben_social_vars, 3, 
                                          "Lubben Social Network Scale ‚Äì 6"))

    ## HOMELESS TIMELINE FOLLOW-BACK (TLFB) #!!! PLACEHOLDER

homeless_tlfb_vars <- c()

# sec_tibble <- rbind(sec_tibble, 
#                     var_tibble_instrument(homeless_tlfb_vars, 4, 
#                                         "Homeless Timeline Follow-Back (TLFB)"))
    
    ## Resource Utilization Questionnaire

resource_ut_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("ruq_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(resource_ut_vars, 5, 
                                          "Resource Utilization Questionnaire"))

    ## Barriers to Phone Based Case Management

barriers_phone_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("bpm_"))
         ) %>%
  names())

sec_tibble <- rbind(sec_tibble, 
                    var_tibble_instrument(barriers_phone_vars, 6, 
                                    "Barriers to Phone Based Case Management"))

    # Aggregating section

interpersonal_vars <- c(interper_support_vars, religious_vars, 
                        lubben_social_vars,  homeless_tlfb_vars, 
                        resource_ut_vars, barriers_phone_vars)

sec_tibble <- sec_tibble %>%
  mutate(sec_ord = 7,
         section = "Interpersonal")

variable_order <- rbind(variable_order, sec_tibble)
```


### COVID Section

```{r}
    ## COVID-19 Vaccination

covid_vax_vars <- sort(colname_tibble %>%
  select(all_of(starts_with("vac_"))
         ) %>%
  names())

sec_tibble <- var_tibble_instrument(covid_vax_vars, 1, 
                                    "COVID-19 Vaccination Questionnaire")

sec_tibble <- sec_tibble %>%
  mutate(sec_ord = 8,
         section = "COVID")

variable_order <- rbind(variable_order, sec_tibble)
```


### Administrative Variables

We examined the remaining aggregated variables. These variables were administrative in nature: subject ID, date of collection, visit number, visit type, start time, end time, elapsed time, and interviewer initials.

```{r}
setdiff(colnames(colname_tibble),variable_order$variable)
```

We manually assigned an order to these variables, then added them to our aggregated variable order map.

```{r}
admin_vars <- c('subject', 'visit', 'today', 'ii', 'visit_type', 'start_time', 
                'end_time', 'elapsed_time')

sec_tibble <- var_tibble_instrument(admin_vars, 1, 
                                    "Administrative Variables")

sec_tibble <- sec_tibble %>%
  mutate(sec_ord = 1,
         section = "Administrative")

variable_order <- rbind(variable_order, sec_tibble)
```

### Verification of Order Map

We reorganized the columns of our variable order map, in order to make it more intuitive when read by a human. We then organized the map first by section order, then instrument order, then item order to achieve our final desired variable order.

```{r}
variable_order <- variable_order[,c('variable', 'sec_ord', 'section', 
                                    'inst_ord', 'instrument', 'item_ord')]

variable_order <- variable_order %>%
  arrange(sec_ord, inst_ord, item_ord)
```

## Stacking Data

We initialized our combined data set, with all our variables in our desired order.

```{r}
combined_data <- tibble::tibble(!!!variable_order$variable, .rows = 0,
                                .name_repair = ~variable_order$variable)
```

We added variables that were missing from each data set as a series of missing values, to facilitate stacking the data sets.

```{r}
v1_reorder[, setdiff(variable_order$variable, colnames(v1_reorder))] <- NA
v2_reorder[, setdiff(variable_order$variable, colnames(v2_reorder))] <- NA
```

We stacked the data sets into our combined data set.

```{r}
combined_data <- rbind(combined_data, v1_reorder)
combined_data <- rbind(combined_data, v2_reorder)
```

```{r}
dim(v1_reorder)
dim(v2_reorder)
dim(combined_data)
```



# BOTTOM

```{r}
    # QDS administrative columns ==============================================
    SUBJECT, TODAY_V2, II_V2, VISIT_V2, TEST_V2, VISIT_TYPE,
    
    # Screening ===============================================================
    
    ## Screening Questionnaire
    ### NOT USED VX
    
    ## Mini Mental State Exam
    ### NOT USED VX
    
    ## Rapid Estimate of Adult Literacy in Medicine (REALM)
    ### NOT USED VX
    
    ## Biological/Anthropometric Measures
    ### NOT USED VX
    
    ## Locator Form
    ### NOT USED VX
    
    # SOCIOECONOMIC STATUS/DEMOGRAPHICS/HOMELESSNESS/CRIMINAL HISTORY INFORMATION 
    
    ## Demographic/Background Information Questionnaire
    ### NOT USED VX
    
    ## The Brief Homelessness Questionnaire
    ### NOT USED VX
    
    ## MacArthur Scale of Subjective Social Status
    ### NOT USED VX
    
    # HEALTH, MENTAL HEALTH, & HEALTH BEHAVIOR ================================
    
    ## Patient Health Questionnaire
    ### NOT USED VX
    
    ## SF 12 Health Survey
    ### NOT USED VX
    
    ## Health Related Quality of Life
    ### NOT USED VX
    
    ## Self-Rated Health
    ### NOT USED VX
    
    ## TCU Drug Screen 5
    ### NOT USED VX
    
    ## Primary Care PTSD Screen (PC-PTSD)
    ### NOT USED VX
    
    ## BRFSS Adverse Childhood Experience (ACE) Module
    ### NOT USED VX
    
    ## Tobacco History
    ### NOT USED VX
    
    ## Heaviness of Smoking Index
    ### NOT USED VX
    
    ## Behavioral Risk Factor Surveillance System (BRFSS) Inadequate Sleep
    ### NOT USED VX
    
    ## Alcohol Quantity and Frequency Questionnaire
    ### NOT USED VX
    
    ## Alcohol and Drug Timeline Follow-Back (TLFB)
    ### NOT USED VX
    
    ## Personality Beliefs Questionnaire
    ### NOT USED VX
    
    ## USDA Food Security Survey
    ### NOT USED VX
    
    ## Meal Survey
    ### NOT USED VX
    
    ## TCU CJ Client Evaluation of Self and Treatment (CJ CEST)
    ### NOT USED VX
    
    ## Sexual Behaviors
    ### NOT USED VX
    
    # STRESS ==================================================================
    
    ## Detroit Area Study Assessment of Day-to-Day Discrimination
    ### NOT USED VX
    
    ## MacArthur Major Discrimination
    ### NOT USED VX
    
    ## Urban Life Stress Scale
    ### NOT USED VX
    
    ## Personal Victimization
    ### NOT USED VX
    
    ## Perceived Stress Scale
    ### NOT USED VX
    
    ## Distress Tolerance Scale (DTS)
    ### NOT USED VX
    
    ## The Pandemic Stress Index (PSI)
    ### NOT USED VX
    
    # NEGATIVE AFFECT =========================================================
    
    ## Aggression Questionnaire (AQ-12)
    ### NOT USED VX
    
    ## Center for Epidemiological Studies Depression (CES-D)
    ### NOT USED VX
    
    # INTERPERSONAL/INTRAPERSONAL RESOURCES ===================================
    
    ## Interpersonal Support Evaluation List
    ### NOT USED VX
    
    ## Religious Participation
    ### NOT USED VX
    
    ## Lubben Social Network Scale ‚Äì 6
    ### NOT USED VX
    
    ## HOMELESS TIMELINE FOLLOW-BACK (TLFB)
    ### NOT USED VX
    
    ## Resource Utilization Questionnaire
    ### NOT USED VX
    
    ## Barriers to Phone Based Case Management
    ### NOT USED VX

    # End of sections from the Link2Care appendix =============================
    
    ## Add everything() to make sure no columns are lost. Many of these will be
    ## calculated variables from the SPSS script. 
    everything()
```
