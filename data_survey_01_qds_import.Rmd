---
title: "Import Link2Care Survey Data - QDS"
date: "2020-12-23 <br> Updated: `r Sys.Date()`"
---

# ‚≠êÔ∏èOverview

This file is used to import the Link2Care follow-up visit survey data and do some initial data cleaning.

[Notes on cleaning individual L2C data sets for merging](https://github.com/brad-cannell/link2care_public/wiki/Notes-on-cleaning-individual-L2C-data-sets-for-merging)

# üì¶Load packages

```{r message=FALSE}
library(dplyr, warn.conflicts = FALSE)
library(purrr, warn.conflicts = FALSE)
library(haven, warn.conflicts = FALSE)
library(officer, warn.conflicts = FALSE)
library(readr, warn.conflicts = FALSE)
library(tidyr, warn.conflicts = FALSE)
library(stringr, warn.conflicts = FALSE)
library(testthat, warn.conflicts = FALSE)
```

```{r}
source("R/standardize_col_names.R")
source("R/add_source_attr.R")
```


# üì•Import data 

Import all 5 QDS data frames

```{r}
qds_spss_path <- "../Participant Data/Combined Participant Data/SPSS Data/QDS Data/"
qds_spss_paths <- paste0(qds_spss_path, "Visit_", 1:5, "_Data.SAV")
```

Check the most recent file modification dates on the UTHealth servers and print for user when this file is being sourced.

```{r}
walk(
  .x = c(1:5),
  .f = function(x) {
    sav_nm <- paste0("Visit_", x, "_Data.SAV")
    path <- paste0(qds_spss_path, sav_nm)
    cat(
      sav_nm, "last modified on OneDrive", as.character(file.info(path)$mtime), "\n"
    )
  }
)
```

```{r}
walk(
  .x = c(1:5),
  .f = function(x) {
    new_nm <- paste0("v", x)
    sav_nm <- paste0("Visit_", x, "_Data.SAV")
    path <- paste0(qds_spss_path, sav_nm)
    assign(new_nm, read_sav(path), envir = .GlobalEnv)
  }
)

rm(qds_spss_path)
```

Print a message for when this file is being sourced

```{r}
walk(
  .x = c(1:5),
  .f = function(x) {
    df_nm <- paste0("v", x)
    df <- get(df_nm, envir = .GlobalEnv)
    # Print a message for when this file is being sourced
    cat(
      paste0(Sys.Date(), ":"),
      df_nm, "imported with", nrow(df), "rows and", ncol(df), "columns.\n"
    )
  }
)

# These are expected to change over time as we add more people to the study.
# However, drastic changes from month-to-month, or even quarter-to-quarter,
# should initiate an investigation into what's going on.
# 2022-08-06: v1 imported with 401 rows and 810 columns.
# 2022-08-06: v2 imported with 369 rows and 213 columns.
# 2022-08-06: v3 imported with 243 rows and 542 columns.
# 2022-08-06: v4 imported with 179 rows and 598 columns.
# 2022-08-06: v5 imported with 152 rows and 649 columns.

# 2023-04-13: v1 imported with 442 rows and 810 columns.
# 2023-04-13: v2 imported with 406 rows and 213 columns.
# 2023-04-13: v3 imported with 273 rows and 542 columns.
# 2023-04-13: v4 imported with 207 rows and 598 columns.
# 2023-04-13: v5 imported with 173 rows and 649 columns.
```

```{r}
v1 %>% select(starts_with("phq"))
```



# Clean column names

We have to make the column names match across visits so that we can merge all of the individual QDS data frames into one.

## Reorder column names and manual changes

1. The columns in the data are not arranged in the order that they exist in the actual QDS survey for some reason. This makes the data harder to work with, and it will make the codebook we eventually create difficult to use. So, we are going to reorder them. To prevent us from typing out 810 variable names manually, we are going to read-in the variable names from the codebook and then create a blog of text that we copy and paste into a code chunk using `select()` below. Prepping the codebook to be able to do this took a long time and isn't very future-proof. However, we should only have to do this step once. As changes occur to QDS in the future, we can just update the code chunk with the `select()` function.

2. There are some instances where it makes sense to make manual changes to column names now, before the standardization process below. For example, the MMSE columns. It's better to manually change them now because after standardize_col_names you can no longer cut and paste from the Word codebooks. Also, it becomes difficult to be sure which variables in the data correspond to which variables in the codebook (e.g., "mms_4" and "mms_4v").There will also be additional manual changes made after the standardization process. 

### Change log

On **2021-06-10**, VISIT_TYPE was added to QDS. This change affects V1-V5.

On **2021-06-05**, Joe Waring found a discrepancy between the way Tobacco 26 was being asked in QDS and REDCap. 

In QDS, T26_V1, T26_V3, T26_V4, and T26_V5 read:

Which option would give you the best chance for quitting smoking?
1	=	Medications
2	=	Counseling
3	=	Both medications and counseling
4	=	Smartphone app
5	=	Both smartphone app and medications
6	=	Quitting "cold turkey" - without counseling or medications
9	=	skipped

And only one answer choice was possible.

In REDCap, t26_v1 reads:

If you were to try to quit smoking, which of the following would you prefer to receive: (select all that apply)

1 t26_v1___1 Medications
2 t26_v1___2 Group Counseling
3 t26_v1___3 Smartphone app
4 t26_v1___4 In person individual counseling
5 t26_v1___5 Helpline phone counseling
6 t26_v1___6 None of the above

Where multiple answers are possible and t26_v1___1 - t26_v1___6 are dummy variables.

On 2021-06-30 the QDS survey was changed to be more like the REDCap survey. The QDS data now has T26A_V1, T26A_V1A, T26A_V1B, T26A_V1C, T26A_V1D, T26A_V1E, and T26A_V1F that correspond to t26_v1___1 - t26_v1___6 in REDCap.

Remember that because of a naming error with T3B_V1, T26_V1 was already manually changed to T27 in the QDS Word codebooks (e.g., L2C_V1 Codebook.docx) by MBC. Changing "T26_V1" (the name that appears in the outdated codebook) to "T26A_V1" (the name that actually appears in the data frame now).

This change affects V1, V3, V4, and V5.

### v1: Reorder column names and manual changes

```{r}
v1 <- v1 %>% 
  select(
    TODAY_V1, VISIT_TYPE, II_V1, VISIT_V1, TEST_V1, 
    
    # Add intuitive names to the screening question (demographic) variables
    GENDER, sq_hispanic = SQ_2, sq_race = SQ_3, sq_age = SQ_4, SQ_5, SQ_6, SQ_7, 
    SQ_7A, SQ_7B, SQ_7C, SQ_7D, SQ_8, SQ_9, SQ_9L, SQ_10, SQ_11, SQ_12, SQ_13, 
    SQ_14, SQ_15, SQ_16, SQ_17, SQ_18, SQ_18A, SQ_18B, SQ_18C, SQ_18D, SQ_18E, 
    SQ_18F, SQ_18G, SQ_18H, SQ_18I, SQ_19, SQ_20, SQ_21, SQ_22, SQ_22A, SQ_22B, 
    SQ_22C, SQ_22D, SQ_22E, SQ_22F, SQ_22G, SQ_22H,
    
    # Changes to MMSE column names
    # In visit 1, the MMSE questions go MMS_4, MMS_4A-MMS_4F, COUNT, MMS4V, 
    # MMS4VA-MMS4VF, NUM, MMS_5. However, MMS4V should have been MMS_5 and 
    # MMS_5 should have been MMS_6, etc. This proliferates all the way down 
    # the questions. We need to fix these before the standardization process.

    # Better to do this now because after standardize_col_names you can no 
    # longer cut and paste from the Word codebooks. Also, it becomes difficult 
    # to be sure which variables in the data correspond to which variables in 
    # the codebook (e.g., "mms_4" and "mms_4v").

    # Additionally, I'm going to add the section name (mms) in front of some of 
    # the column names that don't include it. For example, RECAL1 to mms_recall1.
    MMS_1A, MMS_1B, MMS_1C, MMS_1D, MMS_1E, MMS_1, MMS_2A, MMS_2B, MMS_2C, MMS_2D, 
    MMS_2E, MMS_2, MMS_3, MMS_3G, MMS_3H, MMS_3I, MMS_3J, 
    mms_recall_1 = RECAL1, 
    MMS_4, MMS_4A, MMS_4B, MMS_4C, MMS_4D, MMS_4E, MMS_4F, 
    mms_count = COUNT, 
    mms_5 = MMS4V, 
    mms_5a = MMS4VA, 
    mms_5b = MMS4VB, 
    mms_5c = MMS4VC, 
    mms_5d = MMS4VD, 
    mms_5e = MMS4VE, 
    mms_5f = MMS4VF, 
    mms_num = NUM, 
    mms_6 = MMS_5, 
    mms_6a = MMS_5A, 
    mms_6b = MMS_5B, 
    mms_6c = MMS_5C, 
    mms_6d = MMS_5D, 
    mms_recall_2 = RECAL2, 
    mms_7 = MMS_6, 
    mms_7a = MMS_6A, 
    mms_7b = MMS_6B, 
    mms_7c = MMS_6C, 
    mms_object = OBJECT, 
    mms_8 = MMS_7, 
    mms_9 = MMS_8, 
    mms_9a = MMS_8A, 
    mms_9b = MMS_8B, 
    mms_9c = MMS_8C, 
    mms_9d = MMS_8D, 
    mms_paper = PAPER, 
    mms_10 = MMS_9, 
    mms_11 = MMS_10, 
    mms_12 = MMS_11, 
    MMS_S, 
   
    # Realm  
    REALM, 
    realm_a = REALMA, 
    realm_b = REALMB, 
    realm_c = REALMC, 
    realm_d = REALMD, 
    realm_e = REALME, 
    realm_f = REALMF, 
    realm_g = REALMG, 
    realm_h = REALMH, 
    realm_i = REALMI, 
    realm_total = REALM_S,  
   
    # Biological/Anthropometric Measures
    SQ_23, SUBJECT, WEIGHT, HEIGHT, WAIST_C, CO_V1, READ1_V1, READ2_V1, 
    read_3 = READ3_V5, CTIME_V1,
    
    # Demographic/Background Information Questionnaire
    # Use intuitive names for many of these variables.
    # Also, demo_16g was incorrectly numbered when the data was created.
    dem_marital_status = DEM1V1, 
    dem_children = DEM2V1, 
    dem_race = DEM3V1, 
    dem_race_mult_n = DEM4V1, 
    dem_race_mult_white = DEM4V1A, 
    dem_race_mult_black = DEM4V1B, 
    dem_race_mult_asian = DEM4V1C, 
    dem_race_mult_pacific = DEM4V1D, 
    dem_race_mult_native = DEM4V1E, 
    dem_race_mult_other = DEM4V1F, 
    dem_edu_20_cat = DEM5V1, 
    dem_edu_ged = DEM5AV1, 
    dem_employ_status = DEM6V1, 
    dem_employ_hpw = DEM6AV1, 
    dem_employ_7days = DME6BV1, 
    dem_ins = DEM7V1, 
    dem_ins_medicare = DEM7V1A, 
    dem_medicaid = DEM7V1B, 
    dem_ins_military = DEM7V1C, 
    dem_ins_private = DEM7V1D, 
    dem_ins_none = DEM7V1E, 
    dem_social_security = DEM8V1, 
    dem_social_security_amount = DEM9V1, 
    dem_snap = DEM10V1, 
    dem_snap_amount = DEM11V1,
    dem_income_source = DEM12V1, 
    dem_income_source_work = DEM12V1A, 
    dem_income_source_criminalized = DEM12V1B, 
    dem_income_source_disability = DEM12V1C, 
    dem_income_source_emp_benefits = DEM12V1D, 
    dem_income_source_self_emp = DEM12V1E, 
    dem_income_source_sex = DEM12V1F, 
    dem_income_source_drugs = DEM12V1G, 
    dem_income_source_social_assistance = DEM12V1H, 
    dem_income_source_student_loans = DEM12V1I, 
    dem_income_source_friends_relatives = DEM12V1J, 
    dem_income_source_other = DEM12V1K, 
    dem_income_source_none = DEM12V1L, 
    dem_income_12_mnth_8_cat = DEM13V1, 
    DEM13AV1, DEM13BV1, DEM13CV1, DEM13DV1, DEM13EV1, DEM13FV1, DEM13GV1, DEM13HV1, 
    dem_income_1_mnth_7_cat = DEM14V1, DEM14AV1, DEM14BV1, DEM14CV1, DEM14DV1, 
    DEM14EV1, DEM14FV1, 
    dem_14g = DEMO16G, 
    dem_veteran = DEM15V1, 
    DEM16V1, 
    dem_sexual_orientation = DEM17V1, 
    dem_transgender = DEM18V1,
   
    # The Brief Homelessness Questionnaire
    # Remove the extra "A" from several names (e.g., BH12AV1)
    # Renumber starting at BH13BV1. BH13BV1, BH13BV1, and BH13CV1 all ask people 
    # if they've been arrested for various things. Ideally, this should have
    # been one long question, but it wasn't. I don't like the idea of having
    # bh_13aa, bh_13ba, bh_13ca, etc. Because the answer choices are all 
    # entirely different, I'm going to treat these as separate questions and 
    # renumber them.
    BH1V1, BH1V1Y, BH1V1M, BH1V1D, BH2V1, BH3V1, BH4V1, BH4V1Y, BH4V1M, BH4V1D, 
    BH5V1, BH6V1, BH7V1, BH7V1Y, BH7V1M, BH7V1W, BH8V1, BH9V1, BH10V1, 
    bh_11 = BH11AV1, 
    bh_12 = BH12AV1, 
    bh_12a = BH12AV1A, 
    bh_12b = BH12AV1B, 
    bh_12c = BH12AV1C, 
    bh_12d = BH12AV1D, 
    bh_12e = BH12AV1E, 
    bh_12f = BH12AV1F, 
    bh_12g = BH12AV1G, 
    bh_12h = BH12AV1H, 
    bh_12i = BH12AV1I, 
    bh_12j = BH12AV1J, 
    bh_12k = BH12AV1K, 
    bh_12l = BH12AV1L, 
    bh_13 = BH13AV1, 
    bh_13a = BH13AV1A, 
    bh_13b = BH13AV1B, 
    bh_13c = BH13AV1C, 
    bh_13d = BH13AV1D, 
    bh_13e = BH13AV1E, 
    bh_13f = BH13AV1F, 
    bh_14 = BH13BV1, 
    bh_14a = BH13BV1A, 
    bh_14b = BH13BV1B, 
    bh_14c = BH13BV1C, 
    bh_14d = BH13BV1D, 
    bh_14e = BH13BV1E, 
    bh_14f = BH13BV1F, 
    bh_14g = BH13BV1G, 
    bh_14h = BH13BV1H, 
    bh_15 = BH13CV1, 
    bh_15a = BH13CV1A, 
    bh_15b = BH13CV1B, 
    bh_15c = BH13CV1C, 
    bh_15d = BH13CV1D, 
    bh_15e = BH13CV1E, 
    bh_15f = BH13CV1F, 
    bh_15g = BH13CV1G, 
    bh_15h = BH13CV1H, 
    bh_16 = BH14V1, 
    bh_17 = BH14BV1, 
    bh_18y = BH14BV1Y, 
    bh_18m = BH14BV1M, 
    bh_18w = BH14BV1W,
    bh_19 = BH15V1, 
    bh_20 = BH15AV1, 
    bh_21 = BH16V1, 
    bh_22 = BH17V1, 
    bh_22y = BH17V1Y, 
    bh_22m = BH17V1M, 
    bh_22w = BH17V1W, 
    bh_23 = BH18V1, 
    bh_24 = BH18BV1, 
    bh_24a = BH18BV1A, 
    bh_24b = BH18BV1B, 
    bh_24c = BH18BV1C, 
    bh_24d = BH18BV1D, 
    bh_24e = BH18BV1E, 
    bh_24f = BH18BV1F, 
    bh_24g = BH18BV1G, 
    bh_24h = BH18BV1H, 
    bh_24i = BH18B1V1, 
    bh_25 = BH19V1, 
    bh_26 = BH20V1, 
   
    # MacArthur Scale of Subjective Social Status
    SSS1_V1, SSS2_V1,
   
    # Patient Health Questionnaire
    PHQ1_V1, PHQ2_V1, PHQ3_V1, PHQ4_V1, PHQ5_V1, PHQ6_V1, PHQ7_V1, PHQ8_V1, 
    PHQ9_V1, PHQ10_V1, PHQ11_V1, PHQ12_V1, PHQ13_V1, PHQ14_V1, PHQ15_V1,
   
    # SF-12 Health Survey
    HS1_V1, HS2_V1, HS3_V1, HS4_V1, HS5_V1, HS6_V1, HS7_V1, HS8_V1, HS9_V1, 
    HS10_V1, HS11_V1, HS12_V1,
   
    # Health Related Quality of Life
    HRQ1_V1, HRQ2_V1, HRQ3_V1,
   
    # Self-Rated Health Questionnaire
    # The numbering and naming convention in this section gets pretty messed up 
    # below. Since I already have to retype the name of some many of these, I‚Äôm 
    # going to go ahead and give these a better name from the beginning. This 
    # questionnaire is also used in v3, v4, v5
    srh_1 = S2_V1, 
    srh_1a = S2_V1A, 
    srh_1b = S2_V1B, 
    srh_1c = S2_V1C, 
    srh_1d = S2_V1D, 
    srh_1e = S2_V1E, 
    srh_1f = S2_V1F, 
    srh_1g = S2_V1G, 
    srh_1h = S2_V1H, 
    srh_2a = SR3A_V1, 
    srh_2b = SR3B_V1, 
    srh_2c = SR3C_V1, 
    srh_2d = SR3D_V1,
    srh_2e = SR3E_V1,
    srh_2f = SR3F_V1,
    srh_3 = S3_V1,
    srh_4 = S4_V1,
    srh_4a = S4_V1A,
    srh_4b = S4_V1B,
    srh_4c = S4_V1C,
    srh_4d = S4_V1D,
    srh_4e = S4_V1E,
    srh_4f = S4_V1F,
    srh_4g = S4_V1G,
    srh_4h = S4_V1H,
    srh_5 = S5_V1,
    srh_6 = S6_V1,
    srh_7 = S7_V1,
    srh_7a = S7_V1A,
    srh_7b = S7_V1B,
    srh_7c = S7_V1C,
    srh_7d = S7_V1D,
    srh_7e = S7_V1E,
    srh_7f = S7_V1F,
    srh_7g = S7_V1G,
    srh_8 = S8_V1,
    srh_8a = S8_V1A,
    srh_8b = S8_V1B,
    srh_8c = S8_V1C,
    srh_8d = S8_V1D,
    srh_8e = S8_V1E,
    srh_8f = S8_V1F,
    srh_8g = S8_V1G,
    srh_9 = S9_V1,
    srh_9a = S9_V1A,
    srh_9b = S9_V1B,
    srh_9c = S9_V1C,
    srh_9d = S9_V1D,
    srh_9e = S9_V1E,
    srh_9f = S9_V1F,
    srh_9g = S9_V1G,
    srh_9h = S9_V1H,
    srh_9i = S9_V1I,
    srh_9j = S9_V1J,
    srh_9k = S9_V1K,
    srh_9l = S9_V1L,
    srh_9m = S9_V1M,
    srh_9n = S9_V1N,
    srh_9o = S9_V1O,
    srh_9p = S9_V1P,
    srh_9q = S9_V1Q,
    srh_9r = S9_V1R,
    srh_10 = S10_V1,
    srh_11 = S11_V1,
    srh_12 = S12_V1,
    srh_13 = S13_V1,
    srh_14 = S14_V1,
    srh_14a = S14_V1A,
    srh_14b = S14_V1B,
    srh_14c = S14_V1C,
    srh_14d = S14_V1D,
    srh_15 = S15_V1,
    srh_16 = S16_V1,
    srh_17 = S17_V1,
    srh_18 = S18_V1,
    srh_18a = S18_V1A,
    srh_18b = S18_V1B,
    srh_18c = S18_V1C,
    srh_18d = S18_V1D,
    srh_18e = S18_V1E,
    srh_18f = S18_V1F,
    srh_18g = S18_V1G,
    srh_18h = S18_V1H,
    srh_18i = S18_V1I,
    srh_18j = S18_V1J,
    srh_18k = S18_V1K,
    srh_18l = S18_V1L,
    srh_19 = S19_V1,
    srh_20 = S20_V1,
    srh_21 = S21_V1,
    srh_22 = S22_V1,
    srh_23 = S23_V1,
    srh_24 = S24_V1,
    srh_24a = S24_V1A,
    srh_24b = S24_V1B,
    srh_24c = S24_V1C,
    srh_24d = S24_V1D,
    srh_24e = S24_V1E,
    srh_24f = S24_V1F,
    srh_25 = S25A_V1,
    srh_26 = S26A_V1,
    srh_26a = S26A_V1A,
    srh_26b = S26A_V1B,
    srh_26c = S26A_V1C,
    srh_26d = S26A_V1D,
    srh_26e = S26A_V1E,
    srh_26f = S26A_V1F,
    srh_26g = S26A_V1G,
    srh_27 = S25B_V1,
    srh_28 = S26B_V1,
    srh_28a = S26B_V1A,
    srh_28b = S26B_V1B,
    srh_28c = S26B_V1C,
    srh_28d = S26B_V1D,
    srh_28e = S26B_V1E,
    srh_28f = S26B_V1F,
    srh_28g = S26B_V1G,
    srh_29 = S25C_V1,
    srh_30 = S26C_V1,
    srh_30a = S26C_V1A,
    srh_30b = S26C_V1B,
    srh_30c = S26C_V1C,
    srh_30d = S26C_V1D,
    srh_30e = S26C_V1E,
    srh_30f = S26C_V1F,
    srh_30g = S26C_V1G,
    srh_31 = S25D_V1,
    srh_32 = S26D_V1,
    srh_32a = S26D_V1A,
    srh_32b = S26D_V1B,
    srh_32c = S26D_V1C,
    srh_32d = S26D_V1D,
    srh_32e = S26D_V1E,
    srh_32f = S26D_V1F,
    srh_32g = S26D_V1G,
    srh_33 = S25E_V1,
    srh_34 = S26E_V1,
    srh_34a = S26E_V1A,
    srh_34b = S26E_V1B,
    srh_34c = S26E_V1C,
    srh_34d = S26E_V1D,
    srh_34e = S26E_V1E,
    srh_34f = S26E_V1F,
    srh_34g = S26E_V1G,
    srh_35 = S27_V1,
    srh_36 = S28_V1,
    srh_37 = S29_V1,
    srh_38 = S30_V1,
    srh_38a = S30_V1A,
    srh_38b = S30_V1B,
    srh_38c = S30_V1C,
    srh_38d = S30_V1D,
    srh_38e = S30_V1E,
    srh_38f = S30_V1F,
    srh_38g = S30_V1G,
    srh_39 = S31_V1,
    srh_40 = S32_V1,
    srh_40a = S32_V1A,
    srh_40b = S32_V1B,
    srh_40c = S32_V1C,
    srh_40d = S32_V1D,
    srh_40e = S32_V1E,
    srh_40f = S32_V1F,
    srh_40g = S32_V1G,
    srh_40h = S32_V1H,
    srh_40i = S32_V1I,
    srh_41 = S33_V1,
    srh_42 = S34_V1,
    srh_43 = S35_V1,
    srh_44 = S36_V1,
    srh_45 = S37_V1,
    srh_46 = S38_V1,
    srh_47 = S39A_V1,
    srh_48 = S39B_V1,
    srh_49 = S40_V1,
    srh_50 = S41_V1,
    srh_51 = S42_V1,
    srh_52 = S43_V1,
    srh_52a = S43_V1A,
    srh_52b = S43_V1B,
    srh_52c = S43_V1C,
    srh_52d = S43_V1D,
    srh_52e = S43_V1E,
    srh_52f = S43_V1F,
    srh_52g = S43_V1G,
    srh_52h = S43_V1H,
    srh_52i = S43_V1I,
   
    # PTSD Screen
    PTSD1_V1, PTSD2_V1, PTSD3_V1, PTSD4_V1,
   
    # Tobacco History Questionnaire
    # T3B_V1 should really be t4. This throws off the numbering all the way 
    # through the questionnaire.
    # On 2021-06-30 the QDS survey was changed to be more like the REDCap survey. 
    # Explained above
    T1_V1, T2_V1, 
    t_3 = T3A_V1,
    t_3y = T3A_V1Y,
    t_3m = T3A_V1M,
    t_4 = T3B_V1,
    t_5 = T4_V1,
    t_6 = T5_V1,
    t_6a = T5A1_V1,
    t_6b = T5A2_V1,
    t_6c = T5A3_V1,
    t_6d = T5A4_V1,
    t_6e = T5A5_V1,
    t_6f = T5A6_V1,
    t_7 = T6_V1,
    t_7a = T6A1_V1,
    t_7b = T6A2_V1,
    t_7c = T6A3_V1,
    t_7d = T6A4_V1,
    t_7e = T6A5_V1,
    t_7f = T6A6_V1,
    t_8 = T7_V1,
    t_9 = T8_V1,
    t_10 = T9_V1,
    t_11 = T10_V1,
    t_12 = T11_V1,
    t_13 = T12_V1,
    t_13a = T12A_V1,
    t_13b = T12B_V1,
    t_14 = T13_V1,
    t_15 = T14_V1,
    t_15a = T14_V1A,
    t_15b = T14_V1B,
    t_15c = T14_V1C,
    t_15d = T14_V1D,
    t_15e = T14_V1E,
    t_15f = T14_V1F,
    t_15g = T14_V1G,
    t_15h = T14_V1H,
    t_15i = T14_V1I,
    t_16 = T15_V1,
    t_17 = T16_V1,
    t_18 = T17_V1,
    t_19 = T18_V1,
    t_20 = T19_V1,
    t_21 = T20_V1,
    t_22 = T21_V1,
    t_23 = T22_V1,
    t_24 = T23_V1,
    t_24a = T23_V1A,
    t_24b = T23_V1B,
    t_24c = T23_V1C,
    t_24d = T23_V1D,
    t_24e = T23_V1E,
    t_24f = T23_V1F,
    t_24g = T23_V1G,
    t_24h = T23_V1H,
    t_25 = T24_V1,
    t_26 = T25_V1,
    t_27 = T26A_V1,
    t_27a = T26A_V1A,
    t_27b = T26A_V1B,
    t_27c = T26A_V1C,
    t_27d = T26A_V1D,
    t_27e = T26A_V1E,
    t_27f = T26A_V1F,
    t_28 = T27_V1,
    t_29 = T28_V1,
    t_30 = T29_V1,
    t_31 = T30_V1,
    t_32 = T31_V1,
    t_32a = T31_V1A,
    t_32b = T31_V1B,
    t_32c = T31_V1C,
    t_32d = T31_V1D,
    t_32e = T31_V1E,
    t_32f = T31_V1F,
    t_32g = T31_V1G,
    t_32h = T31_V1H,
    t_32i = T31_V1I,
    t_32j = T31_V1J,
    t_33 = T31B_V1,
    t_33a = T31B_V1A,
    t_33b = T31B_V1B,
    t_33c = T31B_V1C,
    t_34 = T32_V1,
    t_35 = T33_V1,
    t_35a = T33_V1A,
    t_35b = T33_V1B,
    t_35c = T33_V1C,
    t_35d = T33_V1D,
    t_35e = T33_V1E,
    t_35f = T33_V1F,
    t_35g = T33_V1G,
    t_35h = T33_V1H,
    t_35i = T33_V1I,
    t_35j = T33_V1J,
    t_36 = T34_V1,
    t_37 = T35_V1,
    t_38 = T36_V1,
    t_39 = T37_V1,
    t_40 = T38_V1,
    t_41 = T39_V1,
    t_42 = T40_V1,
   
    # Heaviness of Smoking Index
    HSI1_V1, HSI2_V1,
   
    # BRFSS - Inadequate Sleep
    BRS1_V1, BRS2_V1, BRS3_V1, BRS4_V1, BRS5_V1,
   
    # Alcohol Quantity, Frequency and Binge Drinking Questionnaire
    AF1_V1, AF2M_V1, AF3TU_V1, AF4W_V1, AF5TH_V1, AF6F_V1, AF6SA_V1, AF8SU_V1, 
    af_drinks = DRINKS, AF9_V1, AF9A_V1, AF9B_V1, AF9C_V1,
   
    # Meal Survey
    MS1_V1, MS2_V1, MS3_V1, ms_4 = MS8_V1,
   
    # Sexual Behaviors
    SB1_V1, SB2_V1, SB3_V1, SB4_V1, SB5_V1, SB6_V1, SB7_V1, SB7_V1A, SB7_V1B, 
    SB7_V1C, SB7_V1D, SB7_V1E, SB7_V1F, SB7_V1G, SB8_V1, SB9_V1,
   
    # Detroit Day Discrimination
    DD1_V1, DD2_V1, DD3_V1, DD4_V1, DD5_V1, DD6_V1, DD7_V1, DD8_V1, DD9_V1, 
    DD10_V1,
   
    # Aggression Questionnaire
    AQ1_V1, AQ2_V1, AQ3_V1, AQ4_V1, AQ5_V1, AQ6_V1, AQ7_V1, AQ8_V1, AQ9_V1, 
    AQ10_V1, AQ11_V1, AQ12_V1,
   
    # CES-D
    CES1_V1, CES2_V1, CES3_V1, CES4_V1, CES5_V1, CES6_V1, CES7_V1, CES8_V1, 
    CES9_V1, CES10_V1,
   
    # Interpersonal Support Evaluation List
    IS1_V1, IS2_V1, IS3_V1, IS4_V1, IS5_V1, IS6_V1, IS7_V1, IS8_V1, IS9_V1, 
    IS10_V1, IS11_V1, IS12_V1,
   
    # Religious Participation
    RP1_V1, RP2_V1,
   
    # Lubben Social Network Scale
    LSN1_V1, LSN2_V1, LSN3_V1, LSN4_V1, LSN5_V1, LSN6_V1,
   
    # Resource Utilization
    R1_V1, R2_V1, R3_V1, R4_V1, R5_V1, R6_V1, R7_V1, R8_V1, R9_V1, R10_V1, 
    R11_V1, 
    r_12 = R11B_V1, 
    r_13 = R12_V1, 
    r_14 = R13_V1, 
    r_15 = R14_V1, 
    r_16 = R15_V1, 
    r_16a = R15_V1A, 
    r_16b = R15_V1B, 
    r_16c = R15_V1C, 
    r_16d = R15_V1D, 
    r_16e = R15_V1E, 
    r_16f = R15_V1F, 
    r_16g = R15_V1G, 
    r_16h = R15_V1H, 
    r_16i = R15_V1I, 
    r_16j = R15_V1J, 
    r_16k = R15_V1K, 
    r_16l = R15_V1L, 
    r_16m = R15_V1M, 
    r_16n = R15_V1N, 
    r_16o = R15_V1O,
   
    # Barriers to Phone Based Case Management
    BPM1_V1, BPM2_V1, BPM3_V1, BPM4_V1, BPM5_V1, BPM5_V1A, BPM5_V1B, BPM5_V1C, 
    BPM5_V1D, BPM5_V1E, BPM5_V1F, BPM5_V1G, endtime = ENDTIME1, ETIME_V1,
   
    # Add everything() to make sure no columns are lost. Many of these will be
    # calculated variables from the SPSS script. 
    everything()
)
```

Take a look at what comes after `ETIME_V1`. Over time, if new variables are added to the QDS data, this could change. If it does, we may want to rename or rearrange the new columns.

```{r}
# v1 %>%
#   select(ETIME_V1:ncol(.))
```

```{r}
# v1 %>% 
#   select(t_4, t_5, T5_V1val)
```

I'm not sure what T5_V1val is or where it comes from. I think the first thing I'm going to do is just get a complete codebook created. After that's done, I'm sure there will be lots of little issues to clean up. I'm come back and take care of this then.

### v1: Add source attribute for codebook

```{r}
# Can't pipe the data frame in
add_source_attr(v1, "Visit 1")
```

### v2: Reorder column names and manual changes

```{r}
v2 <- v2 %>% 
  select(
    TODAY_V2, VISIT_TYPE, II_V2, SUBJECT, VISIT_V2, TEST_V2, READ1_V2, READ2_V2, 
    READ3_V2, CTIME_V2,
    
    # TCU Drug Screen 5
    DS1_V2, DS2_V2, DS3_V2, DS4_V2, DS5_V2, DS6_V2, DS7_V2, DS8_V2, DS9_V2, 
    DS10A_V2, DS10B_V2, DS11A_V2, DS11B_V2, 
    
    # BRFSS Adverse Childhood Experience (ACE) Model
    BRAC1, BRAC2, BRAC3, BRAC4, BRAC5, BRAC6, BRAC7, BRAC8, BRAC9, BRAC10, BRAC11, 
    
    # Personality Beliefs Questionnaire-Short Form- Antisocial Beliefs
    PBQ1, PBQ2, PBQ3, PBQ4, PBQ5, PBQ6, PBQ7, 
    
    # Food Security
    FSS1_V2, FSS2_V2, FSS3_V2, FSS3A_V2, FSS4_V2, FSS5_V2, 
    
    # TCU CJ Client Evaluation of Self and Treatment
    CJ1_V2, CJ2_V2, CJ3_V2, CJ4_V2, CJ5_V2, CJ6_V2, CJ7_V2, CJ8_V2, CJ9_V2, 
    CJ10_V2, CJ11_V2, CJ12_V2, CJ13_V2, CJ14_V2, CJ15_V2, CJ16_V2, CJ17_V2, 
    CJ18_V2, CJ19_V2, CJ20_V2, CJ21_V2, CJ22_V2, CJ23_V2, CJ24_V2, CJ25_V2, 
    CJ26_V2, CJ27_V2, CJ28_V2, CJ29_V2, CJ30_V2, CJ31_V2, CJ32_V2, CJ33_V2, 
    CJ34_V2, CJ35_V2, CJ36_V2, CJ37_V2, CJ38_V2, CJ39_V2, CJ40_V2, 
    
    # COVID-19 Vaccine
    VAC1_V2, VAC2_V2, VAC3_V2,
    
    # MacArthur Major Discrimination
    MMD1A, MMD1B, MMD1C, MMD1D, MMD1E, MMD1F, MMD1G, MMD1H, MMD1I, MMD1J, MMD1K, 
    MMD2, MMD3, MMD4, 
    
    # Urban Life Stressor Scale
    ULS1_V2, ULS2_V2, ULS3_V2, ULS4_V2, ULS5_V2, ULS6_V2, ULS7_V2, ULS8_V2, 
    ULS9_V2, ULS10_V2, ULS11_V2, ULS12_V2, ULS13_V2, ULS14_V2, ULS15_V2, 
    ULS16_V2, ULS17_V2, ULS18_V2, ULS19_V2, ULS20_V2, ULS21_V2, 
    
    # Personal Victimization
    pv_1 = PV1_V2, pv_2 = PV2_V2, pv_3 = PV3_V2, 
    
    # Perceived Stress Scale
    PS1_V2, PS2_V2, PS3_V2, PS4_V2, 
    
    # Distress Tolerance Scale
    DTS1_V2, DTS2_V2, DTS3_V2, DTS4_V2, DTS5_V2, DTS6_V2, DTS7_V2, DTS8_V2, 
    DTS9_V2, DTS10_V2, DTS11_V2, DTS12_V2, DTS13_V2, DTS14_V2, DTS15_V2, DTS16_V2, 
    endtime = ENDTIME2, ETIME_V2,
    
    # Add everything() to make sure no columns are lost. Many of these will be
    # calculated variables from the SPSS script. 
    everything()
) %>% 
  # Drop unneeded columns
  select(-II_V1)
```

### v2: Add attributes for codebook

For now, we will just add the source attribute to all columns. We will add descriptions later after all of the files are merged.

```{r}
for (col in names(v2)) {
  attr(v2[[col]], "source") <- "Visit 2"
}
rm(col)
```


### v3: Reorder column names and manual changes

```{r}
v3 <- v3 %>% 
  select(
    TODAY_V3, VISIT_TYPE, II_V3, SUBJECT, GROUP, VISIT_V3, TEST_V3, 
    
    # Biological/Anthropometric Measures
    GENDER, weight = WEIGHT_3, height = HEIGHT_3, waist_c = WAIST_C3, CO_V3, 
    READ1_V3, READ2_V3, READ3_V3, CTIME_V3, 
    
    # Demographic/Background Information Questionnaire
    # Use intuitive names for many of these variables.
    dem_employ_status = DEM6V3, 
    dem_employ_hpw = DEM6AV3,
    dem_employ_7days = DME6BV3,
    dem_ins = DEM7V3,
    dem_ins_medicare = DEM7V3A,
    dem_medicaid = DEM7V3B,
    dem_ins_military = DEM7V3C,
    dem_ins_private = DEM7V3D,
    dem_ins_none = DEM7V3E,
    dem_social_security = DEM8V3,
    dem_social_security_amount = DEM9V3,
    dem_snap = DEM10V3,
    dem_snap_amount = DEM11V3,
    dem_income_source = DEM12V3,
    dem_income_source_work = DEM12V3A,
    dem_income_source_criminalized = DEM12V3B,
    dem_income_source_disability = DEM12V3C,
    dem_income_source_emp_benefits = DEM12V3D,
    dem_income_source_self_emp = DEM12V3E,
    dem_income_source_sex = DEM12V3F,
    dem_income_source_drugs = DEM12V3G,
    dem_income_source_social_assistance = DEM12V3H,
    dem_income_source_student_loans = DEM12V3I,
    dem_income_source_friends_relatives = DEM12V3J,
    dem_income_source_other = DEM12V3K,
    dem_income_source_none = DEM12V3L,
    dem_income_1_mnth_7_cat = DEM14V3,
    DEM14AV3, DEM14BV3, DEM14CV3, DEM14DV3, DEM14EV3, DEM14FV3, DEM14GV3,
    DEM14HV3,
   
    # The Brief Homelessness Questionnaire
    BH8V3, BH9V3, BH10V3, 
    bh_11 = BH11AV3, 
    bh_16 = BH14V3, 
    bh_17 = BH14BV3, 
    bh_18m = BH14BV3M, 
    bh_18w = BH14BV3W,
    bh_18d = BH14BV3D, 
    bh_23 = BH18V3, 
    bh_24 = BH18BV3, 
    bh_24a = BH18BV3A, 
    bh_24b = BH18BV3B, 
    bh_24c = BH18BV3C, 
    bh_24d = BH18BV3D, 
    bh_24e = BH18BV3E, 
    bh_24f = BH18BV3F, 
    bh_24g = BH18BV3G, 
    bh_24h = BH18BV3H, 
    bh_24i = BH18B1V3, 
   
    # MacArthur Scale of Subjective Social Status
    SSS1_V3, SSS2_V3, 
   
    # Patient Health Questionnaire
    PHQ1_V3, PHQ2_V3, PHQ3_V3, PHQ4_V3, PHQ5_V3, PHQ6_V3, PHQ7_V3, PHQ8_V3, 
    PHQ9_V3, PHQ10_V3, PHQ11_V3, PHQ12_V3, PHQ13_V3, PHQ14_V3, PHQ15_V3, 
   
    # SF-12 Health Survey 
    HS1_V3, HS2_V3, HS3_V3, HS4_V3, HS5_V3, HS6_V3, HS7_V3, HS8_V3, HS9_V3, 
    HS10_V3, HS11_V3, HS12_V3, 
    
    # Health Related Quality of Life
    HRQ1_V3, HRQ2_V3, HRQ3_V3, 
   
    # Self-Rated Health Questionnaire
    srh_1 = S2_V3, 
    srh_1a = S2_V3A, 
    srh_1b = S2_V3B, 
    srh_1c = S2_V3C, 
    srh_1d = S2_V3D,
    srh_1e = S2_V3E,
    srh_1f = S2_V3F,
    srh_1g = S2_V3G,
    srh_1h = S2_V3H,
    srh_2a = SR3A_V3,
    srh_2b = SR3B_V3,
    srh_2c = SR3C_V3,
    srh_2d = SR3D_V3,
    srh_2e = SR3E_V3,
    srh_2f = SR3F_V3,
    srh_18 = S18_V3,
    srh_18a = S18_V3A,
    srh_18b = S18_V3B,
    srh_18c = S18_V3C,
    srh_18d = S18_V3D,
    srh_18e = S18_V3E,
    srh_18f = S18_V3F,
    srh_18g = S18_V3G,
    srh_18h = S18_V3H,
    srh_18i = S18_V3I,
    srh_18j = S18_V3J,
    srh_18k = S18_V3K,
    srh_18l = S18_V3L,
    srh_24 = S24_V3,
    srh_24a = S24_V3A,
    srh_24b = S24_V3B,
    srh_24c = S24_V3C,
    srh_24d = S24_V3D,
    srh_24e = S24_V3E,
    srh_24f = S24_V3F,
    srh_25 = S25A_V3,
    srh_26 = S26A_V3,
    srh_26a = S26A_V3A,
    srh_26b = S26A_V3B,
    srh_26c = S26A_V3C,
    srh_26d = S26A_V3D,
    srh_26e = S26A_V3E,
    srh_26f = S26A_V3F,
    srh_26g = S26A_V3G,
    srh_27 = S25B_V3,
    srh_28 = S26B_V3,
    srh_28a = S26B_V3A,
    srh_28b = S26B_V3B,
    srh_28c = S26B_V3C,
    srh_28d = S26B_V3D,
    srh_28e = S26B_V3E,
    srh_28f = S26B_V3F,
    srh_28g = S26B_V3G,
    srh_29 = S25C_V3,
    srh_30 = S26C_V3,
    srh_30a = S26C_V3A,
    srh_30b = S26C_V3B,
    srh_30c = S26C_V3C,
    srh_30d = S26C_V3D,
    srh_30e = S26C_V3E,
    srh_30f = S26C_V3F,
    srh_30g = S26C_V3G,
    srh_31 = S25D_V3,
    srh_32 = S26D_V3,
    srh_32a = S26D_V3A,
    srh_32b = S26D_V3B,
    srh_32c = S26D_V3C,
    srh_32d = S26D_V3D,
    srh_32e = S26D_V3E,
    srh_32f = S26D_V3F,
    srh_32g = S26D_V3G,
    srh_33 = S25E_V3,
    srh_34 = S26E_V3,
    srh_34a = S26E_V3A,
    srh_34b = S26E_V3B,
    srh_34c = S26E_V3C,
    srh_34d = S26E_V3D,
    srh_34e = S26E_V3E,
    srh_34f = S26E_V3F,
    srh_34g = S26E_V3G,
    srh_35 = S27_V3,
    srh_36 = S28_V3,
    srh_40 = S32_V3,
    srh_40a = S32_V3A,
    srh_40b = S32_V3B,
    srh_40c = S32_V3C,
    srh_40d = S32_V3D,
    srh_40e = S32_V3E,
    srh_40f = S32_V3F,
    srh_40g = S32_V3G,
    srh_40h = S32_V3H,
    srh_40i = S32_V3I,
    srh_41 = S33_V3,
    srh_45 = S37_V3,
    srh_47 = S39A_V3,
    srh_48 = S39B_V3,
    srh_49 = S40_V3,
    srh_50 = S41_V3,
    srh_51 = S42_V3,
    srh_52 = S43_V3,
    srh_52a = S43_V3A,
    srh_52b = S43_V3B,
    srh_52c = S43_V3C,
    srh_52d = S43_V3D,
    srh_52e = S43_V3E,
    srh_52f = S43_V3F,
    srh_52g = S43_V3G,
    srh_52h = S43_V3H,
    srh_52i = S43_V3I,
   
    # Tobacco History Questionnaire
    # On 2021-06-30 the QDS survey was changed to be more like the REDCap survey. 
    # Explained above
    T1_V3, T2_V3, 
    t_3 = T3A_V3,
    t_3y = T3A_V3Y,
    t_3m = T3A_V3M,
    t_4 = T3B_V3,
    t_6 = T5_V3,
    t_6a = T5A1_V3,
    t_6b = T5A2_V3,
    t_6c = T5A3_V3,
    t_6d = T5A4_V3,
    t_6e = T5A5_V3,
    t_6f = T5A6_V3,
    t_7 = T6_V3,
    t_7a = T6A1_V3,
    t_7b = T6A2_V3,
    t_7c = T6A3_V3,
    t_7d = T6A4_V3,
    t_7e = T6A5_V3,
    t_7f = T6A6_V3,
    t_8 = T7_V3,
    t_11 = T10_V3,
    t_17 = T16_V3,
    t_18 = T17_V3,
    t_23 = T22_V3,
    t_25 = T24_V3,
    t_26 = T25_V3,
    t_27 = T26A_V3,
    t_27a = T26A_V3A,
    t_27b = T26A_V3B,
    t_27c = T26A_V3C,
    t_27d = T26A_V3D,
    t_27e = T26A_V3E,
    t_27f = T26A_V3F,
    t_28 = T27_V3,
    t_29 = T28_V3,
    t_30 = T29_V3,
    t_31 = T30_V3,
    t_32 = T31_V3,
    t_32a = T31_V3A,
    t_32b = T31_V3B,
    t_32c = T31_V3C,
    t_32d = T31_V3D,
    t_32e = T31_V3E,
    t_32f = T31_V3F,
    t_32g = T31_V3G,
    t_32h = T31_V3H,
    t_32i = T31_V3I,
    t_32j = T31_V3J,
    t_33 = T31B_V3,
    t_33a = T31B_V3A,
    t_33b = T31B_V3B,
    t_33c = T31B_V3C,
    t_35 = T33_V3,
    t_35a = T33_V3A,
    t_35b = T33_V3B,
    t_35c = T33_V3C,
    t_35d = T33_V3D,
    t_35e = T33_V3E,
    t_35f = T33_V3F,
    t_35g = T33_V3G,
    t_35h = T33_V3H,
    t_35i = T33_V3I,
    t_35j = T33_V3J,
    t_36 = T34_V3,
    t_37 = T35_V3,
    t_38 = T36_V3,
    t_39 = T37_V3,
    t_40 = T38_V3,
    t_41 = T39_V3,
    t_42 = T40_V3,
   
    # Heaviness of Smoking Index
    HSI1_V3, hsi_2 = HSI2_V13, 
   
    # BRFSS - Inadequate Sleep
    BRS1_V3, BRS2_V3, BRS3_V3, BRS4_V3, BRS5_V3, 
   
    # Alcohol Quantity, Frequency and Binge Drinking Questionnaire
    AF1_V3, AF2M_V3, AF3TU_V3, AF4W_V3, AF5TH_V3, AF6F_V3, AF6SA_V3, AF8SU_V3, 
    af_drinks = DRINKS, AF9_V3, AF9A_V3, AF9B_V3, AF9C_V3, 
    
    # Food Security
    FSS1_V3, FSS2_V3, FSS3_V3, FSS3A_V3, FSS4_V3, FSS5_V3, 
    
    # Meal Survey
    MS1_V3, MS2_V3, MS3_V3, MS4_V3, 
    
    # COVID-19 Vaccine
    VAC1_V3, VAC2_V3, VAC3_V3,
    
    # Detroit Day Discrimination
    DD1_V3, DD2_V3, DD3_V3, DD4_V3, DD5_V3, DD6_V3, DD7_V3, DD8_V3, DD9_V3, 
    DD10_V3, 
    
    # Urban Life Stressor Scale
    ULS1_V3, ULS2_V3, ULS3_V3, ULS4_V3, ULS5_V3, ULS6_V3, ULS7_V3, ULS8_V3, 
    ULS9_V3, ULS10_V3, ULS11_V3, ULS12_V3, ULS13_V3, ULS14_V3, ULS15_V3, 
    ULS16_V3, ULS17_V3, ULS18_V3, ULS19_V3, ULS20_V3, ULS21_V3, 
    
    # Personal Victimization
    pv_1 = PV1_V3, pv2 = PV2_V3, 
    
    # Perceived Stress Scale
    PS1_V3, PS2_V3, PS3_V3, PS4_V3, 
    
    # Aggression Questionnaire
    AQ1_V3, AQ2_V3, AQ3_V3, AQ4_V3, AQ5_V3, AQ6_V3, AQ7_V3, AQ8_V3, AQ9_V3, 
    AQ10_V3, AQ11_V3, AQ12_V3, 
    
    # CES-D
    CES1_V3, CES2_V3, CES3_V3, CES4_V3, CES5_V3, CES6_V3, CES7_V3, CES8_V3, 
    CES9_V3, CES10_V3, 
    
    # Interpersonal Support Evaluation List
    IS1_V3, IS2_V3, IS3_V3, IS4_V3, IS5_V3, IS6_V3, IS7_V3, IS8_V3, IS9_V3, 
    IS10_V3, IS11_V3, IS12_V3, 
    
    # Religious Participation
    RP1_V3, RP2_V3, 
    
    # Lubben Social Network Scale
    LSN1_V3, LSN2_V3, LSN3_V3, LSN4_V3, LSN5_V3, LSN6_V3, 
    
    # Resource Utilization
    R1_V3, R2_V3, R3_V3, R4_V3, R5_V3, R6_V3, R7_V3, R8_V3, R9_V3, R10_V3, R11_V3, 
    r_12 = R11B_V3,
    r_13 = R12_V3,
    r_14 = R13_V3,
    r_15 = R14_V3,
    r_16 = R15_V3,
    r_16a = R15_V3A,
    r_16b = R15_V3B,
    r_16c = R15_V3C,
    r_16d = R15_V3D,
    r_16e = R15_V3E,
    r_16f = R15_V3F,
    r_16g = R15_V3G,
    r_16h = R15_V3H,
    r_16i = R15_V3I,
    r_16j = R15_V3J,
    r_16k = R15_V3K,
    r_16l = R15_V3L,
    r_16m = R15_V3M,
    r_16n = R15_V3N,
    r_16o = R15_V3O,
    
    # Treatment Quality and Satisfaction Survey
    TQ1_1V3, TQ2_1V3, TQ14_1V3, TQ1_2V3, TQ2_2V3, TQ3_2V3, TQ4_2V3, TQ9_2V3, 
    TQ10_2V3, TQ11_2V3 = YQ11_2V3, TQ12_2V3, TQ13_2V3, TQ14_2V3, TQ1_3V3, 
    TQ2_3V3, TQ3_3V3, TQ4_3V3, TQ5_3V3, TQ6_3V3, TQ7_3V3, TQ8_3V3, TQ9_3V3, 
    TQ10_3V3, TQ11_3V3, TQ12_3V3, TQ13_3V3, TQ14_3V3, TQ15_3V3, TQ16_3V3, 
    TQ17_3V3, TQ18_3V3, endtime = ENDTIME3, ETIME_V3,
    
    # Add everything() to make sure no columns are lost. Many of these will be
    # calculated variables from the SPSS script. 
    everything()
)
```

### v4: Reorder column names and manual changes

```{r}
v4 <- v4 %>% 
  select(
    TODAY_V4, VISIT_TYPE, II_V4, SUBJECT, GROUP, VISIT_V4, TEST_V4, 
    
    # Biological/Anthropometric Measures
    GENDER, weight = WEIGHT_4, height = HEIGHT, waist_c = WAIST_C4, CO_V4, 
    READ1_V4, READ2_V4, READ3_V4, CTIME_V4, 
    
    # Demographic/Background Information Questionnaire
    # Use intuitive names for many of these variables.
    dem_employ_status = DEM6V4, 
    dem_employ_hpw = DEM6AV4,
    dem_employ_7days = DME6BV4,
    dem_ins = DEM7V4,
    dem_ins_medicare = DEM7V4A,
    dem_medicaid = DEM7V4B,
    dem_ins_military = DEM7V4C,
    dem_ins_private = DEM7V4D,
    dem_ins_none = DEM7V4E,
    dem_social_security = DEM8V4,
    dem_social_security_amount = DEM9V4,
    dem_snap = DEM10V4,
    dem_snap_amount = DEM11V4,
    dem_income_source = DEM12V4,
    dem_income_source_work = DEM12V4A,
    dem_income_source_criminalized = DEM12V4B,
    dem_income_source_disability = DEM12V4C,
    dem_income_source_emp_benefits = DEM12V4D,
    dem_income_source_self_emp = DEM12V4E,
    dem_income_source_sex = DEM12V4F,
    dem_income_source_drugs = DEM12V4G,
    dem_income_source_social_assistance = DEM12V4H,
    dem_income_source_student_loans = DEM12V4I,
    dem_income_source_friends_relatives = DEM12V4J,
    dem_income_source_other = DEM12V4K,
    dem_income_source_none = DEM12V4L,
    dem_income_1_mnth_7_cat = DEM14V4,
    DEM14AV4, DEM14BV4, DEM14CV4, DEM14DV4, DEM14EV4, DEM14FV4, DEM14GV4,
    DEM14HV4,
   
    # The Brief Homelessness Questionnaire
    BH8V4, BH9V4, BH10V4, 
    bh_11 = BH11AV4, 
    bh_16 = BH14V4, 
    bh_17 = BH14BV4, 
    bh_18m = BH14BV4M, 
    bh_18w = BH14BV4W,
    bh_18d = BH14BV4D, 
    bh_23 = BH18V4, 
    bh_24 = BH18BV4, 
    bh_24a = BH18BV4A, 
    bh_24b = BH18BV4B, 
    bh_24c = BH18BV4C, 
    bh_24d = BH18BV4D, 
    bh_24e = BH18BV4E, 
    bh_24f = BH18BV4F, 
    bh_24g = BH18BV4G, 
    bh_24h = BH18BV4H, 
    bh_24i = BH18B1V4, 
   
    # MacArthur Scale of Subjective Social Status
    SSS1_V4, SSS2_V4, 
   
    # Patient Health Questionnaire
    PHQ1_V4, PHQ2_V4, PHQ3_V4, PHQ4_V4, PHQ5_V4, PHQ6_V4, PHQ7_V4, PHQ8_V4, 
    PHQ9_V4, PHQ10_V4, PHQ11_V4, PHQ12_V4, PHQ13_V4, PHQ14_V4, PHQ15_V4, 
   
    # SF-12 Health Survey 
    HS1_V4, HS2_V4, HS3_V4, HS4_V4, HS5_V4, HS6_V4, HS7_V4, HS8_V4, HS9_V4, 
    HS10_V4, HS11_V4, HS12_V4, 
    
    # Health Related Quality of Life
    HRQ1_V4, HRQ2_V4, HRQ3_V4, 
   
    # Self-Rated Health Questionnaire
    srh_1 = S2_V4, 
    srh_1a = S2_V4A, 
    srh_1b = S2_V4B, 
    srh_1c = S2_V4C, 
    srh_1d = S2_V4D,
    srh_1e = S2_V4E,
    srh_1f = S2_V4F,
    srh_1g = S2_V4G,
    srh_1h = S2_V4H,
    srh_2a = SR3A_V4,
    srh_2b = SR3B_V4,
    srh_2c = SR3C_V4,
    srh_2d = SR3D_V4,
    srh_2e = SR3E_V4,
    srh_2f = SR3F_V4,
    srh_18 = S18_V4,
    srh_18a = S18_V4A,
    srh_18b = S18_V4B,
    srh_18c = S18_V4C,
    srh_18d = S18_V4D,
    srh_18e = S18_V4E,
    srh_18f = S18_V4F,
    srh_18g = S18_V4G,
    srh_18h = S18_V4H,
    srh_18i = S18_V4I,
    srh_18j = S18_V4J,
    srh_18k = S18_V4K,
    srh_18l = S18_V4L,
    srh_24 = S24_V4,
    srh_24a = S24_V4A,
    srh_24b = S24_V4B,
    srh_24c = S24_V4C,
    srh_24d = S24_V4D,
    srh_24e = S24_V4E,
    srh_24f = S24_V4F,
    srh_25 = S25A_V4,
    srh_26 = S26A_V4,
    srh_26a = S26A_V4A,
    srh_26b = S26A_V4B,
    srh_26c = S26A_V4C,
    srh_26d = S26A_V4D,
    srh_26e = S26A_V4E,
    srh_26f = S26A_V4F,
    srh_26g = S26A_V4G,
    srh_27 = S25B_V4,
    srh_28 = S26B_V4,
    srh_28a = S26B_V4A,
    srh_28b = S26B_V4B,
    srh_28c = S26B_V4C,
    srh_28d = S26B_V4D,
    srh_28e = S26B_V4E,
    srh_28f = S26B_V4F,
    srh_28g = S26B_V4G,
    srh_29 = S25C_V4,
    srh_30 = S26C_V4,
    srh_30a = S26C_V4A,
    srh_30b = S26C_V4B,
    srh_30c = S26C_V4C,
    srh_30d = S26C_V4D,
    srh_30e = S26C_V4E,
    srh_30f = S26C_V4F,
    srh_30g = S26C_V4G,
    srh_31 = S25D_V4,
    srh_32 = S26D_V4,
    srh_32a = S26D_V4A,
    srh_32b = S26D_V4B,
    srh_32c = S26D_V4C,
    srh_32d = S26D_V4D,
    srh_32e = S26D_V4E,
    srh_32f = S26D_V4F,
    srh_32g = S26D_V4G,
    srh_33 = S25E_V4,
    srh_34 = S26E_V4,
    srh_34a = S26E_V4A,
    srh_34b = S26E_V4B,
    srh_34c = S26E_V4C,
    srh_34d = S26E_V4D,
    srh_34e = S26E_V4E,
    srh_34f = S26E_V4F,
    srh_34g = S26E_V4G,
    srh_35 = S27_V4,
    srh_36 = S28_V4,
    srh_40 = S32_V4,
    srh_40a = S32_V4A,
    srh_40b = S32_V4B,
    srh_40c = S32_V4C,
    srh_40d = S32_V4D,
    srh_40e = S32_V4E,
    srh_40f = S32_V4F,
    srh_40g = S32_V4G,
    srh_40h = S32_V4H,
    srh_40i = S32_V4I,
    srh_41 = S33_V4,
    srh_45 = S37_V4,
    srh_47 = S39A_V4,
    srh_48 = S39B_V4,
    srh_49 = S40_V4,
    srh_50 = S41_V4,
    srh_51 = S42_V4,
    srh_52 = S43_V4,
    srh_52a = S43_V4A,
    srh_52b = S43_V4B,
    srh_52c = S43_V4C,
    srh_52d = S43_V4D,
    srh_52e = S43_V4E,
    srh_52f = S43_V4F,
    srh_52g = S43_V4G,
    srh_52h = S43_V4H,
    srh_52i = S43_V4I,
    
    # TCU Drug Screen 5
    DS1_V4, DS2_V4, DS3_V4, DS4_V4, DS5_V4, DS6_V4, DS7_V4, DS8_V4, DS9_V4, 
    DS10A_V4, DS10B_V4, DS11A_V4, DS11B_V4,
   
    # Tobacco History Questionnaire
    # On 2021-06-30 the QDS survey was changed to be more like the REDCap survey. 
    # Explained above
    T1_V4, T2_V4, 
    t_3 = T3A_V4,
    t_3y = T3A_V4Y,
    t_3m = T3A_V4M,
    t_4 = T3B_V4,
    t_6 = T5_V4,
    t_6a = T5A1_V4,
    t_6b = T5A2_V4,
    t_6c = T5A3_V4,
    t_6d = T5A4_V4,
    t_6e = T5A5_V4,
    t_6f = T5A6_V4,
    t_7 = T6_V4,
    t_7a = T6A1_V4,
    t_7b = T6A2_V4,
    t_7c = T6A3_V4,
    t_7d = T6A4_V4,
    t_7e = T6A5_V4,
    t_7f = T6A6_V4,
    t_8 = T7_V4,
    t_11 = T10_V4,
    t_17 = T16_V4,
    t_18 = T17_V4,
    t_23 = T22_V4,
    t_25 = T24_V4,
    t_26 = T25_V4,
    t_27 = T26A_V4,
    t_27a = T26A_V4A,
    t_27b = T26A_V4B,
    t_27c = T26A_V4C,
    t_27d = T26A_V4D,
    t_27e = T26A_V4E,
    t_27f = T26A_V4F,
    t_28 = T27_V4,
    t_29 = T28_V4,
    t_30 = T29_V4,
    t_31 = T30_V4,
    t_32 = T31_V4,
    t_32a = T31_V4A,
    t_32b = T31_V4B,
    t_32c = T31_V4C,
    t_32d = T31_V4D,
    t_32e = T31_V4E,
    t_32f = T31_V4F,
    t_32g = T31_V4G,
    t_32h = T31_V4H,
    t_32i = T31_V4I,
    t_32j = T31_V4J,
    t_33 = T31B_V4,
    t_33a = T31B_V4A,
    t_33b = T31B_V4B,
    t_33c = T31B_V4C,
    t_35 = T33_V4,
    t_35a = T33_V4A,
    t_35b = T33_V4B,
    t_35c = T33_V4C,
    t_35d = T33_V4D,
    t_35e = T33_V4E,
    t_35f = T33_V4F,
    t_35g = T33_V4G,
    t_35h = T33_V4H,
    t_35i = T33_V4I,
    t_35j = T33_V4J,
    t_36 = T34_V4,
    t_37 = T35_V4,
    t_38 = T36_V5,
    t_39 = T37_V5,
    t_40 = T38_V5,
    t_41 = T39_V5,
    t_42 = T40_V5,
   
    # Heaviness of Smoking Index
    HSI1_V4, hsi_2 = HSI2_V14, 
   
    # BRFSS - Inadequate Sleep
    BRS1_V4, BRS2_V4, BRS3_V4, BRS4_V4, BRS5_V4, 
   
    # Alcohol Quantity, Frequency and Binge Drinking Questionnaire
    AF1_V4, AF2M_V4, AF3TU_V4, AF4W_V4, AF5TH_V4, AF6F_V4, AF6SA_V4, AF8SU_V4, 
    af_drinks = DRINKS, AF9_V4, AF9A_V4, AF9B_V4, AF9C_V4, 
    
    # Food Security
    FSS1_V4, FSS2_V4, FSS3_V4, FSS3A_V4, FSS4_V4, FSS5_V4, 
    
    # Meal Survey
    MS1_V4, MS2_V4, MS3_V4, MS4_V4, 
    
    # TCU CJ Client Evaluation of Self and Treatment
    CJ1_V4, CJ2_V4, CJ3_V4, CJ4_V4, CJ5_V4, CJ6_V4, CJ7_V4, CJ8_V4, CJ9_V4, 
    CJ10_V4, CJ11_V4, CJ12_V4, CJ13_V4, CJ14_V4, CJ15_V4, CJ16_V4, CJ17_V4, 
    CJ18_V4, CJ19_V4, CJ20_V4, CJ21_V4, CJ22_V4, CJ23_V4, CJ24_V4, CJ25_V4, 
    CJ26_V4, CJ27_V4, CJ28_V4, CJ29_V4, CJ30_V4, CJ31_V4, CJ32_V4, CJ33_V4, 
    CJ34_V4, CJ35_V4, CJ36_V4, CJ37_V4, CJ38_V4, CJ39_V4, CJ40_V4,
    
    # COVID-19 Vaccine
    VAC1_V4, VAC2_V4, VAC3_V4,
    
    # Detroit Day Discrimination
    DD1_V4, DD2_V4, DD3_V4, DD4_V4, DD5_V4, DD6_V4, DD7_V4, DD8_V4, DD9_V4, 
    DD10_V4, 
    
    # Urban Life Stressor Scale
    ULS1_V4, ULS2_V4, ULS3_V4, ULS4_V4, ULS5_V4, ULS6_V4, ULS7_V4, ULS8_V4, 
    ULS9_V4, ULS10_V4, ULS11_V4, ULS12_V4, ULS13_V4, ULS14_V4, ULS15_V4, 
    ULS16_V4, ULS17_V4, ULS18_V4, ULS19_V4, ULS20_V4, ULS21_V4, 
    
    # Personal Victimization
    pv_1 = PV1_V4, pv2 = PV2_V4, 
    
    # Perceived Stress Scale
    PS1_V4, PS2_V4, PS3_V4, PS4_V4, 
    
    # Aggression Questionnaire
    AQ1_V4, AQ2_V4, AQ3_V4, AQ4_V4, AQ5_V4, AQ6_V4, AQ7_V4, AQ8_V4, AQ9_V4, 
    AQ10_V4, AQ11_V4, AQ12_V4, 
    
    # CES-D
    CES1_V4, CES2_V4, CES3_V4, CES4_V4, CES5_V4, CES6_V4, CES7_V4, CES8_V4, 
    CES9_V4, CES10_V4, 
    
    # Interpersonal Support Evaluation List
    IS1_V4, IS2_V4, IS3_V4, IS4_V4, IS5_V4, IS6_V4, IS7_V4, IS8_V4, IS9_V4, 
    IS10_V4, IS11_V4, IS12_V4, 
    
    # Religious Participation
    RP1_V4, RP2_V4, 
    
    # Lubben Social Network Scale
    LSN1_V4, LSN2_V4, LSN3_V4, LSN4_V4, LSN5_V4, LSN6_V4, 
    
    # Resource Utilization
    R1_V4, R2_V4, R3_V4, R4_V4, R5_V4, R6_V4, R7_V4, R8_V4, R9_V4, R10_V4, R11_V4, 
    r_12 = R11B_V4,
    r_13 = R12_V4,
    r_14 = R13_V4,
    r_15 = R14_V4,
    r_16 = R15_V4,
    r_16a = R15_V4A,
    r_16b = R15_V4B,
    r_16c = R15_V4C,
    r_16d = R15_V4D,
    r_16e = R15_V4E,
    r_16f = R15_V4F,
    r_16g = R15_V4G,
    r_16h = R15_V4H,
    r_16i = R15_V4I,
    r_16j = R15_V4J,
    r_16k = R15_V4K,
    r_16l = R15_V4L,
    r_16m = R15_V4M,
    r_16n = R15_V4N,
    r_16o = R15_V4O,
    
    # Treatment Quality and Satisfaction Survey
    TQ1_1V4, TQ2_1V4, TQ14_1V4, TQ1_2V4, TQ2_2V4, TQ3_2V4, TQ4_2V4, TQ9_2V4, 
    TQ10_2V4, tq_11_2 = YQ11_2V4, TQ12_2V4, TQ13_2V4, TQ14_2V4, TQ1_3V4, 
    TQ2_3V4, TQ3_3V4, TQ4_3V4, TQ5_3V4, TQ6_3V4, TQ7_3V4, TQ8_3V4, TQ9_3V4, 
    TQ10_3V4, TQ11_3V4, TQ12_3V4, TQ13_3V4, TQ14_3V4, TQ15_3V4, TQ16_3V4, 
    TQ17_3V4, TQ18_3V4, endtime = ENDTIME4, ETIME_V4,
    
    # Add everything() to make sure no columns are lost. Many of these will be
    # calculated variables from the SPSS script. 
    everything()
)
```

### v5: Reorder column names and manual changes

```{r}
v5 <- v5 %>% 
  select(
    TODAY_V5, VISIT_TYPE, II_V5, SUBJECT, GROUP, VISIT_V5, TEST_V5, 
    
    # Biological/Anthropometric Measures
    GENDER, weight = WEIGHT_5, HEIGHT_V5, waist_c = WAIST_C5, CO_V5, READ1_V5, 
    READ2_V5, READ3_V5,
    
    # Mini Mental Status Exam Score
    mms_1a = MMS_1A_V5, 
    mms_1b = MMS_1B_V5, 
    mms_1c = MMS_1C_V5, 
    mms_1d = MMS_1D_5, 
    mms_1e = MMS_1E_V5, 
    mms_1 = MMS_1_V5, 
    mms_2a = MMS_2A_V5, 
    mms_2b = MMS_2B_V5, 
    mms_2c = MMS_2C_V5, 
    mms_2d = MMS_2D_V5, 
    mms_2e = MMS_2E_V5, 
    mms_2 = MMS_2_V5, 
    mms_3 = MMS_3V5, 
    mms_3g = MMS_3V5G, 
    mms_3h = MMS_3V5H, 
    mms_3i = MMS_3V5I, 
    mms_3j = MMS_3V5J, 
    mms_recall_1 = RECAL1_V5, 
    mms_4 = MMS_4_V5, 
    mms_4a = MMS_4_V5A, 
    mms_4b = MMS_4_V5B, 
    mms_4c = MMS_4_V5C, 
    mms_4d = MMS_4_V5D, 
    mms_4e = MMS_4_V5E, 
    mms_4f = MMS_4_V5F, 
    mms_count = COUNT_V5, 
    mms_5 = MMS4_V5, 
    mms_5a = MMS4_V5A, 
    mms_5b = MMS4_V5B, 
    mms_5c = MMS4_V5C, 
    mms_5d = MMS4_V5D, 
    mms_5e = MMS4_V5E, 
    mms_5f = MMS4_V5F, 
    mms_num = NUM_V5, 
    mms_6 = MMS_5_V5, 
    mms_6a = MMS_5_V5A, 
    mms_6b = MMS_5_V5B, 
    mms_6c = MMS_5_V5C, 
    mms_6d = MMS_5_V5D, 
    mms_recall_2 = RECAL2_V5, 
    mms_7 = MMS_6_V5, 
    mms_7a = MMS_6_V5A, 
    mms_7b = MMS_6_V5B, 
    mms_7c = MMS_6_V5C, 
    mms_object = OBJECT_V5, 
    mms_8 = MMS_7_V5, 
    mms_9 = MMS_8_V5, 
    mms_9a = MMS_8_V5A, 
    mms_9b = MMS_8_V5B, 
    mms_9c = MMS_8_V5C, 
    mms_9d = MMS_8_V5D, 
    mms_paper = PAPER_V5,
    mms_10 = MMS_9_V5, 
    mms_11 = MMS_10_V5, 
    mms_12 = MMS_11_V5, 
    MMS_S_V5, CTIME_V5,
    
    # Demographic/Background Information Questionnaire
    # Use intuitive names for many of these variables.
    dem_employ_status = DEM6V5, 
    dem_employ_hpw = DEM6AV5,
    dem_employ_7days = DME6BV5,
    dem_ins = DEM7V5,
    dem_ins_medicare = DEM7V5A,
    dem_medicaid = DEM7V5B,
    dem_ins_military = DEM7V5C,
    dem_ins_private = DEM7V5D,
    dem_ins_none = DEM7V5E,
    dem_social_security = DEM8V5,
    dem_social_security_amount = DEM9V5,
    dem_snap = DEM10V5,
    dem_snap_amount = DEM11V5,
    dem_income_source = DEM12V5,
    dem_income_source_work = DEM12V5A,
    dem_income_source_criminalized = DEM12V5B,
    dem_income_source_disability = DEM12V5C,
    dem_income_source_emp_benefits = DEM12V5D,
    dem_income_source_self_emp = DEM12V5E,
    dem_income_source_sex = DEM12V5F,
    dem_income_source_drugs = DEM12V5G,
    dem_income_source_social_assistance = DEM12V5H,
    dem_income_source_student_loans = DEM12V5I,
    dem_income_source_friends_relatives = DEM12V5J,
    dem_income_source_other = DEM12V5K,
    dem_income_source_none = DEM12V5L,
    dem_income_1_mnth_7_cat = DEM14V5,
    DEM14AV5, DEM14BV5, DEM14CV5, DEM14DV5, DEM14EV5, DEM14FV5, DEM14GV5,
    DEM14HV5,
   
    # The Brief Homelessness Questionnaire
    BH8V5, BH9V5, BH10V5, 
    bh_11 = BH11AV5, 
    bh_16 = BH14V5, 
    bh_17 = BH14BV5, 
    bh_18m = BH14BV5M, 
    bh_18w = BH14BV5W,
    bh_18d = BH14BV5D, 
    bh_23 = BH18V5, 
    bh_24 = BH18BV5, 
    bh_24a = BH18BVA, 
    bh_24b = BH18BV5B, 
    bh_24c = BH18BV5C, 
    bh_24d = BH18BV5D, 
    bh_24e = BH18BV5E, 
    bh_24f = BH18BV5F, 
    bh_24g = BH18BV5G, 
    bh_24h = BH18BV5H, 
    bh_24i = BH18B1V5,  
    
    # MacArthur Scale of Subjective Social Status
    SSS1_V5, SSS2_V5, 
   
    # Patient Health Questionnaire
    PHQ1_V5, PHQ2_V5, PHQ3_V5, PHQ4_V5, PHQ5_V5, PHQ6_V5, PHQ7_V5, PHQ8_V5, 
    PHQ9_V5, PHQ10_V5, PHQ11_V5, PHQ12_V5, PHQ13_V5, PHQ14_V5, PHQ15_V5, 
   
    # SF-12 Health Survey
    HS1_V5, HS2_V5, HS3_V5, HS4_V5, HS5_V5, HS6_V5, HS7_V5, HS8_V5, HS9_V5, 
    HS10_V5, HS11_V5, HS12_V5,
    
    # Health Related Quality of Life
    HRQ1_V5, HRQ2_V5, HRQ3_V5, 
   
    # Self-Rated Health Questionnaire
    srh_1 = S2_V5, 
    srh_1a = S2_V5A, 
    srh_1b = S2_V5B, 
    srh_1c = S2_V5C, 
    srh_1d = S2_V5D,
    srh_1e = S2_V5E,
    srh_1f = S2_V5F,
    srh_1g = S2_V5G,
    srh_1h = S2_V5H,
    srh_2a = SR3A_V5,
    srh_2b = SR3B_V5,
    srh_2c = SR3C_V5,
    srh_2d = SR3D_V5,
    srh_2e = SR3E_V5,
    srh_2f = SR3F_V5,
    srh_5 = S5_V5,
    srh_6 = S6_V5,
    srh_18 = S18_V5,
    srh_18a = S18_V5A,
    srh_18b = S18_V5B,
    srh_18c = S18_V5C,
    srh_18d = S18_V5D,
    srh_18e = S18_V5E,
    srh_18f = S18_V5F,
    srh_18g = S18_V5G,
    srh_18h = S18_V5H,
    srh_18i = S18_V5I,
    srh_18j = S18_V5J,
    srh_18k = S18_V5K,
    srh_18l = S18_V5L,
    srh_24 = S24_V5,
    srh_24a = S24_V5A,
    srh_24b = S24_V5B,
    srh_24c = S24_V5C,
    srh_24d = S24_V5D,
    srh_24e = S24_V5E,
    srh_24f = S24_V5F,
    srh_25 = S25A_V5,
    srh_26 = S26A_V5,
    srh_26a = S26A_V5A,
    srh_26b = S26A_V5B,
    srh_26c = S26A_V5C,
    srh_26d = S26A_V5D,
    srh_26e = S26A_V5E,
    srh_26f = S26A_V5F,
    srh_26g = S26A_V5G,
    srh_27 = S25B_V5,
    srh_28 = S26B_V5,
    srh_28a = S26B_V5A,
    srh_28b = S26B_V5B,
    srh_28c = S26B_V5C,
    srh_28d = S26B_V5D,
    srh_28e = S26B_V5E,
    srh_28f = S26B_V5F,
    srh_28g = S26B_V5G,
    srh_29 = S25C_V5,
    srh_30 = S26C_V5,
    srh_30a = S26C_V5A,
    srh_30b = S26C_V5B,
    srh_30c = S26C_V5C,
    srh_30d = S26C_V5D,
    srh_30e = S26C_V5E,
    srh_30f = S26C_V5F,
    srh_30g = S26C_V5G,
    srh_31 = S25D_V5,
    srh_32 = S26D_V5,
    srh_32a = S26D_V5A,
    srh_32b = S26D_V5B,
    srh_32c = S26D_V5C,
    srh_32d = S26D_V5D,
    srh_32e = S26D_V5E,
    srh_32f = S26D_V5F,
    srh_32g = S26D_V5G,
    srh_33 = S25E_V5,
    srh_34 = S26E_V5,
    srh_34a = S26E_V5A,
    srh_34b = S26E_V5B,
    srh_34c = S26E_V5C,
    srh_34d = S26E_V5D,
    srh_34e = S26E_V5E,
    srh_34f = S26E_V5F,
    srh_34g = S26E_V5G,
    srh_35 = S27_V5,
    srh_36 = S28_V5,
    srh_39 = S31_V5,
    srh_40 = S32_V5,
    srh_40a = S32_V5A,
    srh_40b = S32_V5B,
    srh_40c = S32_V5C,
    srh_40d = S32_V5D,
    srh_40e = S32_V5E,
    srh_40f = S32_V5F,
    srh_40g = S32_V5G,
    srh_40h = S32_V5H,
    srh_40i = S32_V5I,
    srh_41 = S33_V5,
    srh_45 = S37_V5,
    srh_47 = S39A_V5,
    srh_48 = S39B_V5,
    srh_49 = S40_V5,
    srh_50 = S41_V5,
    srh_51 = S42_V5,
    srh_52 = S43_V5,
    srh_52a = S43_V5A,
    srh_52b = S43_V5B,
    srh_52c = S43_V5C,
    srh_52d = S43_V5D,
    srh_52e = S43_V5E,
    srh_52f = S43_V5F,
    srh_52g = S43_V5G,
    srh_52h = S43_V5H,
    srh_52i = S43_V5I,
    
    # TCU Drug Screen 5
    DS1_V5, DS2_V5, DS3_V5, DS4_V5, DS5_V5, DS6_V5, DS7_V5, DS8_V5, DS9_V5, 
    DS10A_V5, DS10B_V5, DS11A_V5, DS11B_V5,
   
    # Tobacco History Questionnaire
    # On 2021-06-30 the QDS survey was changed to be more like the REDCap survey. 
    # Explained above
    T1_V5, T2_V5, 
    t_3 = T3A_V5,
    t_3y = T3A_V5Y,
    t_3m = T3A_V5M,
    t_4 = T3B_V5,
    t_6 = T5_V5,
    t_6a = T5A1_V5,
    t_6b = T5A2_V5,
    t_6c = T5A3_V5,
    t_6d = T5A4_V5,
    t_6e = T5A5_V5,
    t_6f = T5A6_V5,
    t_7 = T6_V5,
    t_7a = T6A1_V5,
    t_7b = T6A2_V5,
    t_7c = T6A3_V5,
    t_7d = T6A4_V5,
    t_7e = T6A5_V5,
    t_7f = T6A6_V5,
    t_8 = T7_V5,
    t_11 = T10_V5,
    t_17 = T16_V5,
    t_18 = T17_V5,
    t_23 = T22_V5,
    t_25 = T24_V5,
    t_26 = T25_V5,
    t_27 = T26A_V5,
    t_27a = T26A_V5A,
    t_27b = T26A_V5B,
    t_27c = T26A_V5C,
    t_27d = T26A_V5D,
    t_27e = T26A_V5E,
    t_27f = T26A_V5F,
    t_28 = T27_V5,
    t_29 = T28_V5,
    t_30 = T29_V5,
    t_31 = T30_V5,
    t_32 = T31_V5,
    t_32a = T31_V5A,
    t_32b = T31_V5B,
    t_32c = T31_V5C,
    t_32d = T31_V5D,
    t_32e = T31_V5E,
    t_32f = T31_V5F,
    t_32g = T31_V5G,
    t_32h = T31_V5H,
    t_32i = T31_V5I,
    t_32j = T31_V5J,
    t_33 = T31B_V5,
    t_33a = T31B_V5A,
    t_33b = T31B_V5B,
    t_33c = T31B_V5C,
    t_35 = T33_V5,
    t_35a = T33_V5A,
    t_35b = T33_V5B,
    t_35c = T33_V5C,
    t_35d = T33_V5D,
    t_35e = T33_V5E,
    t_35f = T33_V5F,
    t_35g = T33_V5G,
    t_35h = T33_V5H,
    t_35i = T33_V5I,
    t_35j = T33_V5J,
    t_36 = T34_V5,
    t_37 = T35_V5,
    t_38 = T36_V5,
    t_39 = T37_V5,
    t_40 = T38_V5,
    t_41 = T39_V5,
    t_42 = T40_V5,
   
    # Heaviness of Smoking Index
    HSI1_V5, hsi_2 = HSI2_V5, 
   
    # BRFSS - Inadequate Sleep
    BRS1_V5, BRS2_V5, BRS3_V5, BRS4_V5, BRS5_V5, 
   
    # Alcohol Quantity, Frequency and Binge Drinking Questionnaire
    AF1_V5, AF2M_V5, AF3TU_V5, AF4W_V5, AF5TH_V5, AF6F_V5, AF6SA_V5, AF8SU_V5, 
    af_drinks = DRINKS_V5, AF9_V5, AF9A_V5, AF9B_V5, AF9C_V5, 
    
    # Food Security
    FSS1_V5, FSS2_V5, FSS3_V5, FSS3A_V5, FSS4_V5, FSS5_V5, 
    
    # Meal Survey
    MS1_V5, MS2_V5, MS3_V5, ms_4 = MS8_V5, 
    
    # COVID-19 Vaccine
    VAC1_V5, VAC2_V5, VAC3_V5,
    
    # Detroit Day Discrimination
    DD1_V5, DD2_V5, DD3_V5, DD4_V5, DD5_V5, DD6_V5, DD7_V5, DD8_V5, DD9_V5, 
    DD10_V5, 
    
    # Urban Life Stressor Scale
    ULS1_V5, ULS2_V5, ULS3_V5, ULS4_V5, ULS5_V5, ULS6_V5, ULS7_V5, ULS8_V5, 
    ULS9_V5, ULS10_V5, ULS11_V5, ULS12_V5, ULS13_V5, ULS14_V5, ULS15_V5, 
    ULS16_V5, ULS17_V5, ULS18_V5, ULS19_V5, ULS20_V5, ULS21_V5, 
    
    # Personal Victimization
    pv_1 = PV1_V5, pv2 = PV2_V5, pv3 = PV3_V5, 
    
    # Perceived Stress Scale
    PS1_V5, PS2_V5, PS3_V5, PS4_V5, 
    
    # Distress Tolerance Scale
    DTS1_V5, DTS2_V5, DTS3_V5, DTS4_V5, DTS5_V5, DTS6_V5, DTS7_V5, DTS8_V5, 
    DTS9_V5, DTS10_V5, DTS11_V5, DTS12_V5, DTS13_V5, DTS14_V5, DTS15_V5, DTS16_V5,
    
    # Aggression Questionnaire
    AQ1_V5, AQ2_V5, AQ3_V5, AQ4_V5, AQ5_V5, AQ6_V5, AQ7_V5, AQ8_V5, AQ9_V5, 
    AQ10_V5, AQ11_V5, AQ12_V5, 
    
    # CES-D
    CES1_V5, CES2_V5, CES3_V5, CES4_V5, CES5_V5, CES6_V5, CES7_V5, CES8_V5, 
    CES9_V5, CES10_V5, 
    
    # Interpersonal Support Evaluation List
    IS1_V5, IS2_V5, IS3_V5, IS4_V5, IS5_V5, IS6_V5, IS7_V5, IS8_V5, IS9_V5, 
    IS10_V5, IS11_V5, IS12_V5, 
    
    # Religious Participation
    RP1_V5, RP2_V5, 
    
    # Lubben Social Network Scale
    LSN1_V5, LSN2_V5, LSN3_V5, LSN4_V5, LSN5_V5, LSN6_V5, 
    
    # Resource Utilization
    R1_V5, R2_V5, R3_V5, R4_V5, R5_V5, R6_V5, R7_V5, R8_V5, R9_V5, R10_V5, R11_V5, 
    r_12 = R11B_V5,
    r_13 = R12_V5,
    r_14 = R13_V5,
    r_15 = R14_V5,
    r_16 = R15_V5,
    r_16a = R15_V5A,
    r_16b = R15_V5B,
    r_16c = R15_V5C,
    r_16d = R15_V5D,
    r_16e = R15_V5E,
    r_16f = R15_V5F,
    r_16g = R15_V5G,
    r_16h = R15_V5H,
    r_16i = R15_V5I,
    r_16j = R15_V5J,
    r_16k = R15_V5K,
    r_16l = R15_V5L,
    r_16m = R15_V5M,
    r_16n = R15_V5N,
    r_16o = R15_V5O,
    
    # Barriers to Phone Based Case Management
    BPM1_V5, BPM2_V5, BPM3_V5, BPM4_V5, BPM5_V5, BPM5_V5A, BPM5_V5B, BPM5_V5C, 
    BPM5_V5D, BPM5_V5E, BPM5_V5F, BPM5_V5G,
    
    # Treatment Quality and Satisfaction Survey
    TQ1_1V5, TQ2_1V5, TQ14_1V5, TQ1_2V5, TQ2_2V5, TQ3_2V5, TQ4_2V5, TQ9_2V5, 
    TQ10_2V5, tq_11_2 = YQ11_2V5, TQ12_2V5, TQ13_2V5, TQ14_2V5, TQ1_3V5, 
    TQ2_3V5, TQ3_3V5, TQ4_3V5, TQ5_3V5, TQ6_3V5, TQ7_3V5, TQ8_3V5, TQ9_3V5, 
    TQ10_3V5, TQ11_3V5, TQ12_3V5, TQ13_3V5, TQ14_3V5, TQ15_3V5, TQ16_3V5, 
    TQ17_3V5, TQ18_3V5, endtime = ENDTIME5, ETIME_V5,
    
    # Add everything() to make sure no columns are lost. Many of these will be
    # calculated variables from the SPSS script. 
    everything()
)
```

## Standardize column names

* Remove _v{1, 2, 3} and v{1, 2, 3} from column names   
* Replace spaces with underscores   
* Convert to lower case   
* Add underscore in-between the abbreviated tool name and question number   

This won‚Äôt be perfect, but it will drastically reduce the number of manual changes we have to make.

```{r}
# For when done with testing
walk(
  .x = paste0("v", 1:5),
  .f = function(df_name) {
    df <- get(df_name, envir = .GlobalEnv)
    df <- rename_with(df, standardize_col_names)
    assign(df_name, df, envir = .GlobalEnv)
  }
)
```


# Merge visits 1 through 5

```{r}
qds_all_visits <- v1 %>% 
  bind_rows(v2) %>% 
  bind_rows(v3) %>%
  bind_rows(v4) %>%
  bind_rows(v5) %>%
  arrange(subject, visit)

# qds_all_visits
```


# Additional data cleaning

* Make a couple more column name changes   
* Make id the first column   
* Carry forward time-invariant variables   
* Drop `test`. Not sure why it exists.   
* Drop `subject_1`. Not sure why it exists.   
* Move bh_18d to behind bh_18w (bh_18d wasn't created until v3)   
* Move dem_14h to behind dem_14g (dem_14h wasn't created until v3)   

```{r}
qds_all_visits <- qds_all_visits %>%
  rename(id = subject, date_visit = today) %>% 
  select(-test, -subject_1) %>% 
  relocate(bh_18d, .after = bh_18w) %>% 
  relocate(dem_14h, .after = dem_14g) %>% 
  select(id, group, everything())
```

## Coerce variable types

This will facilitate merging with REDCAp in data_survey_21_merge.Rmd.

```{r}
qds_all_visits <- qds_all_visits %>% 
  mutate(
    af_drinks = as.numeric(af_drinks)
  )
```


# Data check

```{r}
# Future proof this by checking to see if the variables have changed over time.
# If this test fails in the future, come back and make adjustments to how we 
# handle columns as needed.
test_that("The expected columns exists in the qds_all_visits data.", {
  expect_equal(
    length(qds_all_visits),
    1048L
  )
})

# 2023-04-19 The expected columns exists in the qds_all_visits data. --- length(qds_all_visits) not equal to 1049L. 1048 - 1049 == -1
```

Print a message for when this file is being sourced

```{r}
cat(
  paste0(Sys.Date(), ":"),
  "QDS data imported and merged with", nrow(qds_all_visits), "rows and", ncol(qds_all_visits), "columns.\n"
)

# 2022-07-03: QDS data imported and merged with 1241 rows and 1049 columns.
# 2023-04-19: QDS data imported and merged with 1502 rows and 1048 columns.
# 2023-05-15: QDS data imported and merged with 1506 rows and 1048 columns.

```


# üíæSave the data frame

```{r}
rds_path <- "../Participant Data/R Data/qds_all_visits_import.rds"
write_rds(qds_all_visits, "../Participant Data/R data/qds_all_visits_import.rds")

# Michael also wants an SPSS version
spss_path <- "../Participant Data/Combined Participant Data/SPSS Data/QDS Data/qds_all_visits_import.SAV"
write_sav(qds_all_visits, spss_path)
```


Print a message for when this file is being sourced

```{r}
cat(
  paste0(Sys.Date(), ":"),
  "QDS data saved to", rds_path, " and ", spss_path
)
```


# üóëClean up

Don't use `rm(list = ls())` because is causes R to drop the helper functions in data_survey_21_update_all_data.Rmd

```{r}
rm(list = ls()[ls() != "source_rmd"])
```
